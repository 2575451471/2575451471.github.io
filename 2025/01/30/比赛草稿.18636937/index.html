<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>vim批量处理小记 | Shenle</title><meta name="robots" content="noindex">

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="article">
<meta property="og:title" content="vim批量处理小记">
<meta property="og:url" content="https://github.com/2575451471/2575451471.github.io/2025/01/30/%E6%AF%94%E8%B5%9B%E8%8D%89%E7%A8%BF.18636937/index.html">
<meta property="og:site_name" content="Shenle">
<meta property="og:locale">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250111184712660-1210412993.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250111185341415-97482283.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250111192633474-1008956392.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250111204000561-429787781.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250111210205098-1143408468.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250111210221989-297537138.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250112205744407-1410000934.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250112205918762-378016560.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250112210043077-1532961695.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250112210143482-338362388.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250112215420269-855845549.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250112215638033-1392812339.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250112215700005-763275270.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250112223912684-78974397.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250112223934810-2012867097.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250112150849390-485007238.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250114095658863-1218399408.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250114103306098-1117060912.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250114212333216-1350552898.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250114212353261-727668424.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250117204611735-693310103.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250117220917868-732367063.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250117220924945-1190797229.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250117220934172-886956740.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250118125552562-2066922677.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250118125722052-826623675.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250118141756637-1455286223.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250118141448926-302347770.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250118141708261-488478628.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250118152919264-1263876321.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250118223733801-2131690566.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250118225353183-247312401.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250118232733345-714738144.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250118234502743-376662790.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119010851131-741896970.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119134033476-1051796737.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119134048808-1160301746.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119144438049-1003612068.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119161758097-1117114396.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119164110206-1202696223.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119164643082-850948949.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119164811184-172788291.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119165044094-304482812.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119170741914-276941691.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119170754939-1457894078.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119170856809-641701997.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119173241763-1656104253.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119191132958-804158850.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119191552247-796752389.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119191703712-956114543.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119200500507-447346880.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119200956157-61365221.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119204931697-766415196.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119205024440-2021315356.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250120003024428-1761455083.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250120020148436-1933134937.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250120192151992-487349187.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250120192221604-585126226.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250120192451165-1855164261.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250120194322034-1166373335.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250120200743357-258576323.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250120204320505-1353450636.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250120204628788-739176652.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250121000442255-1331141141.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250121233657565-1587753609.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250122191034656-1337419418.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250123215356739-1743824197.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250123215524169-1911880911.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250123220016620-1284821433.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250123221039454-512626546.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250123221336433-1050113142.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250123221607432-1853088420.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124181045014-437677463.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124181234599-1769253669.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124181302131-510446308.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124181317836-2032845170.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124181349201-423186138.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124181437298-792775496.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124181452165-827910632.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124181458079-1686693848.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124181503600-1715621573.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124202829586-614425465.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124213857278-101463945.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124220520442-1003241286.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124220536910-1660724255.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124220621875-1289894835.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124221248381-1299913079.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124221650994-960444146.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124221843181-1875086227.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124222124215-1301321992.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124222405525-888717909.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124224004991-287203804.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250125000226279-1766031866.jpg">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250125031130337-1635724333.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250125043438057-1194407883.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250125182944406-982501107.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250125183842774-1939584058.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250125191842585-121658019.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250126043047614-1760634097.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250127010617982-477973178.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250127011758797-422379380.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250127013532888-1675944540.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250127021603287-962146613.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250127022533123-1509066407.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250127022703683-870587307.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250127030804926-831369317.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250127032434864-20351281.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250127212744932-903632041.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128083504560-1914920773.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128181718126-47698937.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128182039790-1703893036.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128182201119-158605050.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128182308227-1146693076.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128182423392-565787787.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128182543460-818439064.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128182644219-1873339130.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128183606776-2107757927.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128185519311-1979130623.png">
<meta property="og:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128185607412-1815770606.png">
<meta property="article:published_time" content="2025-01-30T04:56:00.000Z">
<meta property="article:modified_time" content="2025-02-14T20:26:54.366Z">
<meta property="article:author" content="shenle">
<meta property="article:tag" content="智能车竞赛">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250111184712660-1210412993.png">
  
    <link rel="alternative" href="/atom.xml" title="Shenle" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
      <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
<script>AV.initialize("your_app_id", "your_app_key");</script>

<script src="/js/Counter.js"></script>

  
<meta name="generator" content="Hexo 7.3.0"></head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
				<img lazy-src="/img/header.png" class="js-avatar">
			
		</a>

		<hgroup>
			<h1 class="header-author"><a href="/">shenle</a></h1>
		</hgroup>

		
			<p class="header-subtitle"></p>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">Home</a></li>
				        
							<li><a href="/archives">Archives</a></li>
				        
						</ul>
					</nav>
					<nav class="half-header-menu">
						<a class="hide">Home</a>
						<a>Tags</a>
						<a>Links</a>
						<a>About</a>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/2575451471" title="github">github</a>
					        
								<a class="cnblogs" target="_blank" href="https://www.cnblogs.com/shenleblog" title="cnblogs">cnblogs</a>
					        
								<a class="qq" target="_blank" href="https://img2023.cnblogs.com/blog/3084836/202502/3084836-20250215043636691-2144966981.jpg" title="qq">qq</a>
					        
						</div>
						<!-- music -->
						
							<!-- <div style="position: absolute; bottom: 120px; left: auto; width: 85%;"> -->
							<div style="position: absolute; left: auto; width: 85%;">
								<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=220 height=86 src="//music.163.com/outchain/player?type=2&id=1941325363&auto=1&height=66"></iframe>
							</div>
						
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/%E4%B8%8A%E8%AF%BE%E7%AC%94%E8%AE%B0/" style="font-size: 20px;">上课笔记</a> <a href="/tags/%E5%B0%8F%E8%AE%B0/" style="font-size: 15px;">小记</a> <a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F32/" style="font-size: 15px;">嵌入式32</a> <a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F51/" style="font-size: 10px;">嵌入式51</a> <a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8Fti/" style="font-size: 10px;">嵌入式ti</a> <a href="/tags/%E6%99%BA%E8%83%BD%E8%BD%A6%E7%AB%9E%E8%B5%9B/" style="font-size: 10px;">智能车竞赛</a> <a href="/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" style="font-size: 20px;">编程语言</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/">github</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">噜啦啦!</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/header.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">Home</a></li>
		        
					<li><a href="/archives">Archives</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/2575451471" title="github">github</a>
			        
						<a class="cnblogs" target="_blank" href="https://www.cnblogs.com/shenleblog" title="cnblogs">cnblogs</a>
			        
						<a class="qq" target="_blank" href="https://img2023.cnblogs.com/blog/3084836/202502/3084836-20250215043636691-2144966981.jpg" title="qq">qq</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-比赛草稿.18636937" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2025/01/30/%E6%AF%94%E8%B5%9B%E8%8D%89%E7%A8%BF.18636937/" class="article-date">
  	<time datetime="2025-01-30T04:56:00.000Z" itemprop="datePublished">2025-01-30</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      vim批量处理小记
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%99%BA%E8%83%BD%E8%BD%A6%E7%AB%9E%E8%B5%9B/" rel="tag">智能车竞赛</a></li></ul>
	</div>

        

        
          
<div class="counter-tag counter">
    <span id="/2025/01/30/%E6%AF%94%E8%B5%9B%E8%8D%89%E7%A8%BF.18636937/" class="leancloud_visitors post-title-link"
          style="font-size: 12px" data-flag-title="vim批量处理小记">
         &nbsp;
        view
    </span>
</div>

        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <meta name="referrer" content="no-referrer"/>
<span id="more"></span>





<h1 id="整体框架"><a href="#整体框架" class="headerlink" title="整体框架"></a>整体框架</h1><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/shenleblog/p/18636937">https://www.cnblogs.com/shenleblog/p/18636937</a><br>密码：123  </p>
<hr>
<h2 id="软件框架"><a href="#软件框架" class="headerlink" title="软件框架"></a>软件框架</h2><ul>
<li>下位机</li>
</ul>
<ol>
<li>按键 （已实现）、</li>
<li>led指示灯（已实现）</li>
<li>舵机的pwm驱动（已实现）</li>
<li>串口通信（已实现）</li>
<li>定时器（已实现）  </li>
<li>编码器（我是想用两个能实现上升沿和下降沿外部中断的io口来软件模拟编码器的计数方式）（未实现）  </li>
<li>电机（方向—两个pwm）（未实现）  </li>
<li>无线串口 （没去看）    </li>
<li>无线下载器（reset出问题，暂时搁置）  （<a target="_blank" rel="noopener" href="https://www.stcaimcu.com/forum.php?mod=viewthread&tid=6796#lastpost%EF%BC%89">https://www.stcaimcu.com/forum.php?mod=viewthread&amp;tid=6796#lastpost）</a>    </li>
<li>屏幕（ips）(还没看)（8针脚屏幕）    </li>
<li>菜单（还没写）</li>
</ol>
<hr>
<ul>
<li>上位机</li>
</ul>
<ol>
<li><em><strong>视觉部分（写了一部分，还在移植）</strong></em>  </li>
<li><em><strong>控制部分（pid）（还没写）</strong></em>  </li>
<li>摄像头问题（两个摄像头的问题）  </li>
<li>linux自启动（没实现）（理论上来说可行）  </li>
<li>大模型（图像识别）(这块我不看)</li>
</ol>
<hr>
<h2 id="线上赛"><a href="#线上赛" class="headerlink" title="线上赛"></a>线上赛</h2><p>（（）） 约等于  大模型（图像识别）(这块我不看)    </p>
<h1 id="要干甚么"><a href="#要干甚么" class="headerlink" title="要干甚么"></a>要干甚么</h1><h2 id="吴小亮"><a href="#吴小亮" class="headerlink" title="吴小亮"></a>吴小亮</h2><ol>
<li>视觉  </li>
<li>控制</li>
</ol>
<h2 id="张中豪"><a href="#张中豪" class="headerlink" title="张中豪"></a>张中豪</h2><ol>
<li>论文  (1.30)  会议（b类，sci（加分：2.5）下面的那个东西（加分：1.5））</li>
<li>ai模型（以及线上赛）  </li>
<li>地瓜    </li>
<li>蓝桥杯（嵌入式）</li>
</ol>
<h2 id="赵璟怡"><a href="#赵璟怡" class="headerlink" title="赵璟怡"></a>赵璟怡</h2><ol>
<li>主板，驱动，转接板（第三版）      </li>
<li>3d打印固定板（edgeboard的固定板，航模插头的小电池的两头固定件）    </li>
<li>摄像头碳素杆的3d固定件（可以有）  </li>
<li>3d打印车壳（可以在杰哥的demo版上改）  </li>
<li>蓝桥杯（eda赛道）</li>
</ol>
<h1 id="一些注意事项"><a href="#一些注意事项" class="headerlink" title="一些注意事项"></a>一些注意事项</h1><h2 id="硬件"><a href="#硬件" class="headerlink" title="硬件"></a>硬件</h2><ol>
<li>打板前最好还是让软件看看（原理图，pcb图）（方便的话在硬件电脑旁对着车看，不方便就截图）（队名，打板时间，学校，队伍logo(可选)，实验室logo（可选），人名（我看好多都没加，我是希望加上（可选）））</li>
<li>3d打印件同上，打印前找队友和车检查一遍先</li>
<li></li>
</ol>
<hr>
<h2 id="ai"><a href="#ai" class="headerlink" title="ai"></a>ai</h2><h2 id="软件"><a href="#软件" class="headerlink" title="软件"></a>软件</h2><h1 id="下学期注意事项"><a href="#下学期注意事项" class="headerlink" title="下学期注意事项"></a>下学期注意事项</h1><h2 id="大二下"><a href="#大二下" class="headerlink" title="大二下"></a>大二下</h2><p>赵总比较忙，学业繁重，比较需要重视成绩<br>按照说法，希望我给的任务要加上deadline，不然会拖很久  </p>
<hr>
<p>总之我重心会在完模这块  </p>
<hr>
<h1 id="小事"><a href="#小事" class="headerlink" title="小事"></a>小事</h1><h2 id="硬件-1"><a href="#硬件-1" class="headerlink" title="硬件"></a>硬件</h2><p>按键 4.7改成其他的</p>
<hr>
<h1 id="日记"><a href="#日记" class="headerlink" title="日记"></a>日记</h1><h2 id="1-9"><a href="#1-9" class="headerlink" title="1.9"></a>1.9</h2><hr>
<p>ok,开工</p>
<hr>
<ul>
<li>21.12<br>成功下回了ADS,成功编译下进了一次代码。<br>stm遥控器卡死在了“等待si24r1的中断接收信号拉低（表示si24r1接收完成）”<br>找不着原因</li>
</ul>
<hr>
<h2 id="1-10"><a href="#1-10" class="headerlink" title="1.10"></a>1.10</h2><p>现在是下午1.30  </p>
<hr>
<p>我们先继续研究ads  </p>
<hr>
<p>一般一个定时器可以输出四路占空比可调的频率相同的PWM信号  </p>
<hr>
<p>ATOM有8个通道，每个通道可以有不同的pwm输出</p>
<hr>
<p>怎么啥都没反应……<br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1ha411A7zW">https://www.bilibili.com/video/BV1ha411A7zW</a><br><a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1C19HQzTqqKKvYgJxL-axUw">https://pan.baidu.com/s/1C19HQzTqqKKvYgJxL-axUw</a></p>
<hr>
<p>ads经常下载失败</p>
<hr>
<p>下载memtool来代替ads下载</p>
<hr>
<p>memtool怎么也这么多事</p>
<hr>
<p>0  (0+0<em>10000&#x2F;8)%(10000&#x2F;2)+(10000&#x2F;2)&#x3D;0+5000&#x3D;5000<br>(0+1</em>10000&#x2F;8)%(10000&#x2F;2)+(10000&#x2F;2)&#x3D;1250+5000&#x3D;6250</p>
<p>duty(max)&#x3D;5000</p>
<hr>
<h2 id="1-11"><a href="#1-11" class="headerlink" title="1.11"></a>1.11</h2><hr>
<ul>
<li>13.01<br>先学c++</li>
</ul>
<hr>
<p>板子有点麻烦</p>
<hr>
<p>先看看板子引脚</p>
<hr>
<p>ai8051<br>芯片flash-64kb<br>芯片ram-34kb<br>封装–lqfp48<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250111184712660-1210412993.png" alt="img"><br><em><strong>错了，这个是STC32的</strong></em></p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250111185341415-97482283.png" alt="img">   </p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250111192633474-1008956392.png" alt="img"></p>
<hr>
<p>利用光栅的衍射可以根据需要把光信号转换为电信号，光电编码器就是根据这个原理制造成的器件。<br>光电编码器可以将位移、角度的变化转换成光电脉冲或数字信号。该器件目前被广泛应用于长度、速度、加速度、振动等的测量以及精密定位中。<br>根据产生脉冲的方式不同，光电编码器可以分为增量式、绝对式、混合式三种类型；  </p>
<p>增量式（用的是增量式）<br>增量式编码器的输出信号是A,B,Z三组方波脉冲。增量式编码器的组成结构和输出信号的波形如下图所示：<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250111204000561-429787781.png" alt="img"><br>码盘上等间距刻录了辐射状透光缝隙，相邻两个透光缝隙之间为一个增量周期。检测光栅上刻有A,B两组与码盘相对应的透光缝隙，来达到通过或遮挡光源与光电检测器件之间的光线的目的。检测光栅上透光缝隙的间距和码盘上的间距相等，并且两组透光缝隙之间相差1&#x2F;4间距，这样使得光电检测器件输出的信号在相位上相差90度的电度角。编码器工作时检测光栅不动，码盘随被测转轴转动，光线透过码盘和检测光栅上的透光缝隙照射到光电探测器件上，光电检测器件就输出两组近似于正弦波的电信号（相位相差90度）电信号经过电路的转换处理，即可得到被测轴的转角或速度信息。<br>增量式编码器结构简单、使用寿命长、受环境影响小、工作稳定。但它只能输出转轴的位置相对于前一个位置的增量，因此，实际工作时需要在一段区域内连续工作，不能中断。  </p>
<p>正交编码器（Quadrature Encoder）是一种用于测量旋转速度和方向的传感器，通过积分（累加）运算后，还可以用来测算距离。最常见的正交编码器有两个输出信号：A相 和 B相，有些编码器会有 Z相 的校准功能（用于消除累计误差）。「正交」一词来源于 AB 两个信号的特征，一般情况下 A相 和 B相 的输出信号总是有 π&#x2F;2 的相位差。  </p>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250111210205098-1143408468.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250111210221989-297537138.png" alt="img"></p>
<p>ui8051<br>两个输入TI1,TI2做增量编码器接口， </p>
<p>如果计数器同时在TI1和TI2边沿计数，则置PWMA_SMCR寄存器中的SMS&#x3D;011.</p>
<p>若计数器已经启动（PWMA_CR1寄存器中的CEN&#x3D;1）</p>
<p>计数器在每次TI1FP1或TI1FP2上产生有效跳变时计数（TI1FP1或TI1FP2是TI1或TI2通过输入滤波器和极性控制后的信号）  </p>
<p>（如果没有滤波和极性变换（TI1FP1&#x3D;TI1,TI2FP2&#x3D;TI2））  </p>
<p>根据两个跳变顺序，产生计数脉冲和方向信号。（依据两个输入喜好的跳变顺序，计数器向上计数或者向下计数，同时对PWMA_CR1的DIR位进行设置）  </p>
<p>每次跳变都会重新计算DIR</p>
<h2 id="1-12"><a href="#1-12" class="headerlink" title="1.12"></a>1.12</h2><p><a target="_blank" rel="noopener" href="https://www.stcaimcu.com/forum.php?mod=viewthread&tid=1911&highlight=%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD&page=2&extra=#pid12736">https://www.stcaimcu.com/forum.php?mod=viewthread&amp;tid=1911&amp;highlight=%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD&amp;page=2&amp;extra=#pid12736</a>   </p>
<blockquote>
<p>stc分外部中断和普通IO中断    </p>
</blockquote>
<ul>
<li><p>外部中断<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250112205744407-1410000934.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250112205918762-378016560.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250112210043077-1532961695.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250112210143482-338362388.png" alt="img"></p>
<blockquote>
<p>外部中断0（INT0）:P3.2 同时支持上下沿中断<br>外部中断1（INT1）:P3.3 同时支持上下沿中断<br>外部中断2（INT2）:P3.6 支持下降沿中断<br>外部中断3（INT3）:P3.7 支持下降沿中断<br>外部中断4（INT4）:P3.0 支持下降沿中断 </p>
</blockquote>
</li>
<li><p>普通IO中断<br>有四种中断模式，下降沿中断、上升沿中断、低电平中断和高电平中断。没个IO都可以独立设置中断模式。<br>不能单个IO口配置中断优先级，只能配置某个IO端口的中断优先级<br><strong>普通IO口中断号大于31，keil不支持，还需要写汇编映射到其他中断号（麻烦）</strong></p>
</li>
</ul>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250112215420269-855845549.jpg" alt="img"><br>哈哈哈，其实算是我第一次实际用51（魔改版）<br>stc32g在用typec口下载的时候需要按reset<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250112215638033-1392812339.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250112215700005-763275270.png" alt="img"></p>
<hr>
<p>来，无线下载<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250112223912684-78974397.png" alt="img"></p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">本帖最后由 王昱顺 于 2024-3-7 13:59 编辑</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">全自动蓝牙下载器, 使用STC8H2K08U和JDY33模块制作 ！</span><br><span class="line">可通讯可下载，自动配置蓝牙模块</span><br><span class="line">完美收尾！现在可以实现STC全系列单片机的无线下载，甚至包括STC8以上型号的检测MCU选项后自动切换正确型号的功能。</span><br><span class="line">非常适合智能车参赛选手实现远程的下载，调试，停车。方便多多</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">前言：</span><br><span class="line">早在之前调试智能车和一些较为恶劣坏境（非电磁环境恶劣，单纯温度比较高这种）的产品的时候，总是苦恼于没法远程下载程序，当时虽然研究过一段时间的远程OTA更新功能，但是这对单片机的型号又做出了一些限制，甚是苦恼。</span><br><span class="line">其实之前也尝试过不少的无线模块，想直接用在下载上。可是尝试过的几款不是因为数据分包发送的巨大延迟导致的通信超时，就是因为STCISP操作串口时直接给端口干掉线了。</span><br><span class="line">但是近来逛论坛的时候，发现有人推荐使用JDY33这款型号的蓝牙模块。马上看了一下淘宝，六块钱包邮。这不赶紧试试！</span><br><span class="line">于是赶忙下订单、收货、测试一条龙。果然网友的消息就是灵通，这一试立马就成功了。</span><br><span class="line">其实事情本该到此结束，毕竟我这无线下载的需求终于实现了。但是我又觉得这种手动断电的方式不大美妙了（串口不断电下载会因为调试程序时的卡死而罢工的，所以也没用）</span><br><span class="line">这不，才有了这个小玩意，自动下载器。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">介绍：</span><br><span class="line">原理其实很简单，就是通过监听蓝牙TXD线路中的0x7F数据。因为STC-ISP下载用的是偶校验，所以单片机串口也要设置成偶校验。检测到足够数量的连续0x7F数据就进行一次自动断电操作（同样的，也可以在蓝牙的数据通道手动发送至少20个的0x7F完成一次冷启动复位）</span><br><span class="line">然后我还加了个小功能，连接TypeC口或者Link1D-4P下载口并供电时，可以一键复位掉蓝牙模块，免去配置波特率和校验位的麻烦。</span><br><span class="line">这个功能其实就是通过在所有波特率轮着发送恢复出厂设置的消息，全发送一遍。肯定就复位了。然后再通过默认的波特率进行通讯和配置。</span><br><span class="line"></span><br><span class="line">这个是整套的样子</span><br></pre></td></tr></table></figure>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250112223934810-2012867097.png" alt="img"></p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250112150849390-485007238.png" alt="img"><br>赵总作品   </p>
<h2 id="1-13"><a href="#1-13" class="headerlink" title="1.13"></a>1.13</h2><p>先验证一下刚到的ai8051  </p>
<p>正在检测目标单片机 …<br>  下载板型号: USB-HID1CDC  </p>
<p>继续检测目标单片机 …<br>  单片机型号: AI8051U-34K64  </p>
<p>当前芯片的硬件选项为:<br>  . 系统ISP工作频率: 23.909MHz<br>  . 内部IRC振荡器的频率: 40.015MHz<br>  . 掉电唤醒定时器的频率: 34.800KHz<br>  . 振荡器放大增益使能<br>  . 用户EEPROM大小被设置为 1 K<br>  . P3.2和P3.3与下次下载无关<br>  . 上电复位时增加额外的复位延时<br>  . 复位引脚用作普通I&#x2F;O口<br>  . 检测到低压时复位<br>  . 低压检测门槛电压 : 2.00 V<br>  . 上电复位时,硬件不启动内部看门狗<br>  . 上电自动启动内部看门狗时的预分频数为 : 256<br>  . 空闲状态时看门狗定时器停止计数<br>  . 下次下载用户程序时,将用户EEPROM区一并擦除<br>  . 下次下载用户程序时,没有相关的端口控制485<br>  . 下次下载时不需要校验下载口令<br>  . 内部参考电压: 1186 mV (参考范围: 1100~1300mV)  </p>
<p>  单片机型号: AI8051U-34K64  </p>
<p>开始调节频率 …			[0.891”]<br>调节后的频率: 39.994MHz (-0.016%)  </p>
<p>正在重新握手 … 成功			[0.187”]<br>当前的波特率: 115200<br>正在擦除目标区域 … 完成 !		[0.672”]<br>正在下载用户代码 … 完成 !		[23.797”]<br>正在设置硬件选项 … 完成 !		[0.031”]  </p>
<p>更新后的硬件选项为:<br>  . 系统ISP工作频率: 23.909MHz<br>  . 内部IRC振荡器的频率: 39.994MHz<br>  . 掉电唤醒定时器的频率: 34.800KHz<br>  . 振荡器放大增益使能<br>  . 用户EEPROM大小被设置为 1 K<br>  . P3.2和P3.3与下次下载无关<br>  . 上电复位时增加额外的复位延时<br>  . 复位引脚用作普通I&#x2F;O口<br>  . 检测到低压时复位<br>  . 低压检测门槛电压 : 2.00 V<br>  . 上电复位时,硬件不启动内部看门狗<br>  . 上电自动启动内部看门狗时的预分频数为 : 256<br>  . 空闲状态时看门狗定时器停止计数<br>  . 下次下载用户程序时,将用户EEPROM区一并擦除<br>  . 下次下载用户程序时,没有相关的端口控制485<br>  . 下次下载时不需要校验下载口令<br>  . 内部参考电压: 1186 mV (参考范围: 1100~1300mV)<br>芯片出厂序列号 : 78B4CAA503C219  </p>
<p>  单片机型号: AI8051U-34K64  </p>
<p>  . 用户设定频率: 40.000MHz<br>  . 调节后的频率: 39.994MHz ( 主时钟分频系数 &#x3D; 1; )<br>  . 频率调节误差: -0.016%  </p>
<h2 id="1-14"><a href="#1-14" class="headerlink" title="1.14"></a>1.14</h2><p>车长30<br>车宽22<br>车高38  </p>
<p>没有适合的盒子大小</p>
<hr>
<p>edgeboard DK-1B<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250114095658863-1218399408.png" alt="img"></p>
<hr>
<p>安装</p>
<p>想要使用libgpiod，需要在开发板上安装libgpiod库。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装libgpiod库及头文件</span></span><br><span class="line"><span class="built_in">sudo</span> apt install libgpiod-dev </span><br><span class="line"><span class="comment">#安装gpiod 命令行工具</span></span><br><span class="line"><span class="built_in">sudo</span> apt install gpiod  </span><br></pre></td></tr></table></figure>
<p>libgpiod<br>libgpiod用于与Linux GPIO设备互动的C语言库和工具。 Linux提供了一种访问GPIO控制器的字符设备接口，通过操作字符设备文件（比如 &#x2F;dev&#x2F;gpiodchip0 ）实现的， 并通过libgpiod提供一些命令工具、c库以及python封装。<br>板卡提供的GPIO扩展，使用的是&#x2F;dev&#x2F;gpiodchip4，对应GPIO端口号参考上文原理图图示，如：GPIO43_3V3表示端口号为43，支持电源3.3v。<br><a href="https://github.com/brgl/libgpiod">https://github.com/brgl/libgpiod</a>  (libgpiod源码仓库)<br><a href="https://github.com/starnight/libgpiod-example">https://github.com/starnight/libgpiod-example</a>  (libgpiod示例代码)  </p>
<hr>
<p>服了，电池过放了，今天运气有点悲啊  </p>
<hr>
<p>，，，電腦輸入發又突然變成繁體了，明明是簡體<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250114103306098-1117060912.png" alt="img"></p>
<hr>
<p>这个windows没完没了了  </p>
<hr>
<p>CmakeListLists.txt  (Cmake编译器)</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span>  <span class="comment">//输入输出流头文件</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/highgui.hpp&gt;</span>  <span class="comment">//gui人机交互界面</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span>  <span class="comment">//cv处理内容</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;<span class="comment">//创建名称空间</span></span><br><span class="line"><span class="keyword">using</span> namspace cv;</span><br><span class="line"></span><br><span class="line">Mat img,gray_img,binary_img;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//获取摄像头图象</span></span><br><span class="line">    <span class="comment">//1.让办卡连接上摄像头：软件初始化摄像头</span></span><br><span class="line">    <span class="function">VideoCapture <span class="title">cap</span><span class="params">(<span class="string">&quot;/dev/video0&quot;</span>)</span></span>;  <span class="comment">//实例化一个摄像头</span></span><br><span class="line">    <span class="keyword">if</span>(!cap.<span class="built_in">isOpened</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;video failed&quot;</span> &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.创建一个窗口来显示</span></span><br><span class="line">    <span class="built_in">namedWindow</span>(<span class="string">&quot;smartcar&quot;</span>,(<span class="number">640</span>,<span class="number">480</span>));<span class="comment">//创建了一个名为smartcar的窗口，大小为640*480</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.定义图象保存的矩阵</span></span><br><span class="line">    <span class="comment">/*3*3（0-255）越大该点越亮</span></span><br><span class="line"><span class="comment">        124   122  229</span></span><br><span class="line"><span class="comment">        111   11    22</span></span><br><span class="line"><span class="comment">        0    0   0</span></span><br><span class="line"><span class="comment">        uint8_t  img[3][3];</span></span><br><span class="line"><span class="comment">        Mat img;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    Mat img;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//4.将摄像头获取的图象赋值给img</span></span><br><span class="line">        cap &gt;&gt; img;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.图像处理操作</span></span><br><span class="line">        <span class="comment">/*   </span></span><br><span class="line"><span class="comment">        1.图象rgb to gray</span></span><br><span class="line"><span class="comment">        2.图象二值化</span></span><br><span class="line"><span class="comment">        3.识别一个直道</span></span><br><span class="line"><span class="comment">        4.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//6.显示图象</span></span><br><span class="line">        <span class="built_in">imshow</span>(<span class="string">&quot;smartcar&quot;</span>,img);<span class="comment">//在smartcar窗口显示img图象</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//7.必要延时</span></span><br><span class="line">        <span class="built_in">waitKey</span>(<span class="number">10</span>);<span class="comment">//等待10ms，等待用户按键操作</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(<span class="string">&quot;smartcar&quot;</span>);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>free -h 查看内存<br>lsblk 查看emmc  </p>
<hr>
<p>今天大进展，但是头有点晕   </p>
<hr>
<p>还是不能全部弃掉，主函数自己写可以，但是官方的封装还是得用<br>明天任重道远   </p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250114212333216-1350552898.png" alt="img"></p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250114212353261-727668424.png" alt="img"></p>
<h2 id="1-15"><a href="#1-15" class="headerlink" title="1.15"></a>1.15</h2><p>无事</p>
<h2 id="1-16"><a href="#1-16" class="headerlink" title="1.16"></a>1.16</h2><p>开三个窗口移植视觉部分</p>
<hr>
<p>记录需要用到的接口部分  </p>
<p>1. </p>
<hr>
<p>两个摄像头直连出现问题    </p>
<ol>
<li>贵摄像头330fps太高速出现频闪，目前没有有效解决办法  </li>
<li>无法同时开启两台摄像头</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">先说下原因，linux中为usb camera提供了一个标准的V4L2的驱动以方便使用，只要符合驱动规范就可以实现即插即用usb camera设备，即免驱动安装。 但市面上的USB 摄像头都是2.0的。usb bus的 bandwidth是有限的，而V4L2驱动采用的是贪心原则，即camera会要求获取最大带宽；因此将两个camera接入一路usb bus，打开第二个camera（尤其是采用YUV格式打开）就会出现”No space left on device”的错误。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<p>直连usb  </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@paddlepi:~/workspace/sasu_icar2024_demo/build# lsusb  </span><br><span class="line">Bus 002 Device 003: ID 0bda:8153 Realtek Semiconductor Corp.  </span><br><span class="line">Bus 002 Device 002: ID 05e3:0626 Genesys Logic, Inc.</span><br><span class="line">Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub</span><br><span class="line">Bus 001 Device 005: ID 10bb:2b08 TM Technology, Inc.                          // 摄像头30fps</span><br><span class="line">Bus 001 Device 004: ID 15aa:1555 Gearway Electronics (Dong Guan) Co., Ltd.   // 摄像头330fps</span><br><span class="line">Bus 001 Device 003: ID 214b:7250</span><br><span class="line">Bus 001 Device 002: ID 05e3:0610 Genesys Logic, Inc. 4-port hub  </span><br><span class="line">Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub</span><br><span class="line">root@paddlepi:~/workspace/sasu_icar2024_demo/build#</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">这种情况下，就会提示libv4l2: error turning on stream: No space left on device， 不管你用opencv 还是qt, 还是xawtv,luvcview, vlc打开，都没用的，这跟上层应用没关系。</span><br><span class="line">因为这是Linux kernel里面的 uvc设备驱动的一个<span class="built_in">bug</span>(<span class="keyword">or</span> feature)。简单描述一下就是，YUV是非压缩的视频格式，对于USB<span class="number">2.0</span>，一旦有一个设备插入，就会静态的占去<span class="number">80</span>%的USB带宽，所以在控制器下再加一个USB设备，就会报错，带宽不够</span><br></pre></td></tr></table></figure>


<hr>
<p>capture.set 的所有可设置选项<br>在OpenCV中，VideoCapture 类的 set 方法用于设置视频捕获设备的各种属性。这些属性通常通过预定义的常量来标识，这些常量在 OpenCV 的 cv::VideoCaptureProperties 枚举中定义。以下是一些常见的 capture.set 可设置选项及其对应的枚举值：</p>
<p>CAP_PROP_POS_MSEC (0)：设置捕获视频的当前位置（以毫秒为单位）。</p>
<p>CAP_PROP_POS_FRAMES (1)：设置捕获视频的当前帧索引。</p>
<p>CAP_PROP_POS_AVI_RATIO (2)：设置捕获视频的当前位置（0 - 1之间的比例）。</p>
<p>CAP_PROP_FRAME_WIDTH (3)：设置捕获视频的帧宽度。</p>
<p>CAP_PROP_FRAME_HEIGHT (4)：设置捕获视频的帧高度。</p>
<p>CAP_PROP_FPS (5)：设置捕获视频的帧率。</p>
<p>CAP_PROP_FOURCC (6)：设置捕获视频的编解码器。注意，这个属性可能不被所有后端支持。</p>
<p>CAP_PROP_BUFFERSIZE (7)：查询或设置视频捕获的后端缓冲区大小。</p>
<p>CAP_PROP_MODE (8)：设置捕获设备的模式。</p>
<p>CAP_PROP_BRIGHTNESS (10)：设置捕获设备的亮度。</p>
<p>CAP_PROP_CONTRAST (11)：设置捕获设备的对比度。</p>
<p>CAP_PROP_SATURATION (12)：设置捕获设备的饱和度。</p>
<p>CAP_PROP_HUE (13)：设置捕获设备的色调。</p>
<p>CAP_PROP_GAIN (14)：设置捕获设备的增益。</p>
<p>CAP_PROP_EXPOSURE (15)：设置捕获设备的曝光时间。</p>
<p>CAP_PROP_CONVERT_RGB (16)：指示图像是否应该被转换为RGB颜色空间。</p>
<p>CAP_PROP_WHITE_BALANCE_BLUE_U (17)：设置白平衡蓝色分量。</p>
<p>CAP_PROP_RECTIFICATION (18)：设置摄像头的校正模式。</p>
<p>CAP_PROP_MONOCHROME (19)：以黑白模式捕获视频。</p>
<p>CAP_PROP_SHARPNESS (21)：设置捕获设备的锐度。</p>
<p>CAP_PROP_AUTO_EXPOSURE (25)：启用&#x2F;禁用自动曝光。</p>
<p>CAP_PROP_GAMMA (26)：设置捕获设备的伽马值。</p>
<p>CAP_PROP_TEMPERATURE (27)：获取红外摄像头的温度读数。</p>
<p>CAP_PROP_BACKLIGHT (28)：启用&#x2F;禁用背光补偿。</p>
<p>CAP_PROP_PAN (32)：设置摄像头的水平视角（平移）。</p>
<p>CAP_PROP_TILT (33)：设置摄像头的垂直视角（倾斜）。</p>
<p>CAP_PROP_ROLL (34)：设置摄像头的旋转角度。</p>
<p>CAP_PROP_ZOOM (35)：设置摄像头的缩放级别。</p>
<p>CAP_PROP_FOCUS (36)：设置摄像头的焦距。</p>
<p>CAP_PROP_GUID (37)：获取视频捕获设备的全局唯一标识符（GUID）。</p>
<p>CAP_PROP_ISO_SPEED (39)：设置ISO速度。</p>
<p>CAP_PROP_MAX_DC1394_CHUNK_SIZE (1074188417)：最大IEEE1394数据块大小。</p>
<p>CAP_PROP_AUTOGRAB (1074311296)：指示设备是否自动抓取帧。</p>
<hr>
<p>折腾完一个下午也没解决问题<br>只能再买一个了<br>现在问题是<br>选择30帧的还是60帧的呢？？？  </p>
<hr>
<p>遇到的问题和上次是一样的  </p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">状态0 --&gt;按键检测&#123;是否按下&#125;</span><br><span class="line">按键检测 --&gt;|按下|状态1</span><br><span class="line">按键检测 --&gt;|没有按下|状态0</span><br><span class="line">状态1 --&gt;按键检测2&#123;是否仍然按下&#125;</span><br><span class="line">按键检测2 --&gt;|仍然按下_消抖成功|状态2</span><br><span class="line">按键检测2 --&gt;|松开了_消抖掉|状态0</span><br><span class="line">状态2 --&gt;按键检测3&#123;是否仍然按下2&#125;</span><br><span class="line">按键检测3 --&gt;|一直按下_计时|time++</span><br><span class="line">按键检测3 --&gt;|松开了_|判断time长短</span><br><span class="line">判断time长短 --&gt;时间判断2&#123;是否够长&#125;</span><br><span class="line">时间判断2 --&gt;|没超过LONG_TIME_此时shortflag挂起|状态0</span><br><span class="line">时间判断2 --&gt;|超过LONG_TIME_此时longflag挂起|状态0</span><br></pre></td></tr></table></figure>
<h2 id="1-17"><a href="#1-17" class="headerlink" title="1.17"></a>1.17</h2><hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250117204611735-693310103.png" alt="img"></p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250117220917868-732367063.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250117220924945-1190797229.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250117220934172-886956740.png" alt="img"><br>原来串口是可以设置中断优先级，但是由于建议采用的定时器不能设置优先级所以串口中断也跟随不设置高优先级，</p>
<p>stc很幽默</p>
<hr>
<hr>
<ol>
<li>封装舵机</li>
<li>测试按键，不封装</li>
<li>测试串口，封装</li>
</ol>
<hr>
<p>服了，逐飞写的封装库不知道为啥不行，我查手册对寄存器单独操作成功上拉了<br>无语无语 </p>
<hr>
<p>35    90   145<br>   55    55  </p>
<hr>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//gpio_pin_enum keypin;</span></span><br><span class="line"><span class="comment">//    uint8_t judge;   //按键状态机，0进入;检测到按下到1;xms后却松开了就回到0（消抖），xms后仍然按下就进入2;xms后按键已经松开判断time分短，归0，xms后按键未松开，判断时间长短（一直未松）直接长按键触发</span></span><br><span class="line"><span class="comment">//    uint8 key_state;  //按键状态，0：按下，1：释放</span></span><br><span class="line"><span class="comment">//    uint8 shortflag;  //短按标志，0：未检测到短按，1：已检测到短按</span></span><br><span class="line"><span class="comment">//    uint8 longflag;  //长按标志，0：未检测到长按，1：已检测到长按</span></span><br><span class="line"><span class="comment">//    uint32_t time;  //按键时间，单位ms</span></span><br></pre></td></tr></table></figure>
<hr>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;isr.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;intrins.h&quot;</span></span></span><br><span class="line"><span class="comment">//------STC32G SDK等</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;AI8051u_32bit.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;zf_common_typedef.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;zf_common_clock.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;zf_common_fifo.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;zf_common_debug.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;zf_common_interrupt.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;zf_common_font.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;zf_common_function.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;zf_driver_gpio.h&quot;</span></span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="1-18"><a href="#1-18" class="headerlink" title="1.18"></a>1.18</h2><p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250118125552562-2066922677.png" alt="img"><br>ai8051的上拉电阻是5.8k<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250118125722052-826623675.png" alt="img"></p>
<hr>
<p>串口做 类 封装<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250118141756637-1455286223.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250118141448926-302347770.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250118141708261-488478628.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250118152919264-1263876321.png" alt="img"></p>
<hr>
<ul>
<li>打印十六进制</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span>：包含这个头文件以使用std::hex和std::uppercase流操纵器。</span></span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; std::hex：设置std::cout为<span class="number">16</span>进制输出模式。</span><br><span class="line"></span><br><span class="line">std::cout &lt;&lt; std::uppercase：使<span class="number">16</span>进制输出使用大写字母（可选）。</span><br><span class="line"></span><br><span class="line"><span class="built_in">static_cast</span>&lt;<span class="type">int</span>&gt;(serialStr.buffFinish[<span class="number">0</span>])：将<span class="type">uint8_t</span>类型的值转换为<span class="type">int</span>类型，因为std::cout默认不会直接处理<span class="type">uint8_t</span>类型。</span><br><span class="line"></span><br><span class="line">std::endl：插入换行符并刷新输出缓冲区。</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过这种方式，您可以确保serialStr.buffFinish[0]的值以16进制格式打印出来，并且是大写形式（如果您选择了std::uppercase）。</span></span><br></pre></td></tr></table></figure>
<hr>
<p>单边循迹<br>四邻域  </p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250118223733801-2131690566.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250118225353183-247312401.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250118232733345-714738144.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250118234502743-376662790.png" alt="img"></p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119010851131-741896970.png" alt="img"></p>
<hr>
<hr>
<hr>
<p>暂时回顾一下，<br>7. 号 考完试<br>8. 号 写报告<br>9. 号 写报告<br>10. 号 折腾ads,失败放弃<br>11. 号 研究stc<br>12. 号 赵总板子出了 重下keil能下进去stc了<br>13. 号 AI8051到了，这会应该在学 c++和opencv<br>14. 号 vscode惨遭windows迫害，（这里13到14好像通宵了）  这会一直想利用edgeboard上的io<br>15. 号 落枕，没干活<br>16. 号 试图移植视觉，但是两个摄像头的问题把我干死很久<br>17. 号 封装测试stc，成绩出了<br>18. 号 下午主要验证上下位机串口通信，晚上移植压缩+二值化</p>
<h2 id="1-19"><a href="#1-19" class="headerlink" title="1.19"></a>1.19</h2><hr>
<p>13.26<br>继续移视觉部分  </p>
<hr>
<p>看看蓝牙<br>（蓝牙串口）<br>SPP蓝牙串口  </p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119134033476-1051796737.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119134048808-1160301746.png" alt="img"><br>过    </p>
<hr>
<p>0 1 2 3 4 5 6 . . . . . . . . . . . 78(LCDW-2) 79(LCDW-1)<br>1<br>2<br>3<br>.<br>.<br>.<br>54    (LCDH-6)<br>55    (LCDH-5)<br>56    (LCDH-4)<br>57    (LCDH-3)<br>58    (LCDH-2)<br>59    (LCDH-1)  </p>
<hr>
<p>0 1 2 3 4 5 6 . . . . . . . . . . . 158(LCDW-2) 159(LCDW-1)<br>1<br>2<br>3<br>.<br>.<br>.<br>114    (LCDH-6)<br>115    (LCDH-5)<br>116    (LCDH-4)<br>117    (LCDH-3)<br>118    (LCDH-2)<br>119    (LCDH-1)  </p>
<hr>
<p>底边异常<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119144438049-1003612068.png" alt="img"></p>
<hr>
<ul>
<li>底边五行的搜索<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119161758097-1117114396.png" alt="img"></li>
</ul>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119164110206-1202696223.png" alt="img"></p>
<hr>
<p>大跳变重新处理<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119164643082-850948949.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119164811184-172788291.png" alt="img"></p>
<hr>
<p>宽度小于（），直接设置为这帧的最高处理行<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119165044094-304482812.png" alt="img"></p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119170741914-276941691.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119170754939-1457894078.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119170856809-641701997.png" alt="img"></p>
<hr>
<p>赵总作品  </p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119173241763-1656104253.png" alt="img"></p>
<hr>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">在C++中，<span class="type">static</span> 关键字可以在多种上下文中使用，包括变量声明、函数声明和类成员声明。当 <span class="type">static</span> 用于函数声明时，它改变了函数的链接性（linkage）。</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> <span class="type">static</span> 函数的特点</span><br><span class="line">内部链接（Internal Linkage）：<span class="type">static</span> 函数具有内部链接，这意味着该函数只能在定义它的源文件内部被访问和调用。换句话说，其他源文件无法看到或调用这个 <span class="type">static</span> 函数。</span><br><span class="line"></span><br><span class="line">避免命名冲突：使用 <span class="type">static</span> 关键字可以避免不同源文件中同名函数的命名冲突。每个源文件中的 <span class="type">static</span> 函数都是独立的，互不影响。</span><br><span class="line"></span><br><span class="line">隐藏实现细节：通过将函数声明为 <span class="type">static</span>，可以隐藏函数的实现细节，使得函数的接口更加清晰，同时减少外部对函数内部逻辑的依赖。</span><br></pre></td></tr></table></figure>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119191132958-804158850.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119191552247-796752389.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119191703712-956114543.png" alt="img"><br>集美大学17届  </p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119200500507-447346880.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119200956157-61365221.png" alt="img"></p>
<ul>
<li>-<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119204931697-766415196.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250119205024440-2021315356.png" alt="img"></li>
</ul>
<hr>
<p><em><strong>主板（stc绿色第一版）往外引出</strong></em>  </p>
<ol>
<li>主板（stc绿色第一版）供电线  接到  红色驱动板（旧）  </li>
<li>主板（stc绿色第一版）的电机线（三根）（dir,pwm,vcc）线   接到    红色驱动板（旧）  </li>
<li>主板（stc绿色第一版）舵机线（三根）（pwm,vcc,gnd）   接到    舵机（引出线）  </li>
<li>主板（stc绿色第一版）编码器线（四根）（A,B,gnd,vcc）(不知道线序)    接到  编码器（引出线）  <strong>（第一版）这里需要跳线，将A,B跳到p3.3,p3.2，看手册，两个io口接同一个外设线是可行的</strong>  </li>
<li>主板（stc绿色第一版）串口接口  接到   edgeboardusb接口二</li>
</ol>
<hr>
<p><em><strong>红色驱动板（旧）往外引出</strong></em><br>省去 连接到 主板 的    </p>
<ol>
<li>红色驱动板（旧）供电线  接到  电池    </li>
<li>红色驱动板（旧）电机连接线（两根）  接到  电机（引出线）</li>
</ol>
<hr>
<p><em><strong>edgeboard往外引出</strong></em>  </p>
<ol>
<li>usb接口一  接到  摄像头</li>
<li>usb接口二  接到  主板（stc绿色第一版）串口接口</li>
<li>（<strong>第一版</strong>）dc供电口  接到  红色驱动板（旧）</li>
</ol>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250120003024428-1761455083.png" alt="img"></p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250120020148436-1933134937.png" alt="img"></p>
<hr>
<h2 id="1-20"><a href="#1-20" class="headerlink" title="1.20"></a>1.20</h2><p>规划了一下   </p>
<hr>
<p>把车装好了  </p>
<hr>
<p>电机成功驱动</p>
<hr>
<p>一个小问题，当占空比较低的时候，给电机轮胎一个反方向推力，很容易让电机停转<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250120192151992-487349187.png" alt="img"></p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250120192221604-585126226.png" alt="img"></p>
<hr>
<p>我一开始使用的是逐飞例程的17khz，<br>然后根据论坛的说法改到3khz，出现这个现象的最低占空比变低了，但是噪音变大了 】</p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250120192451165-1855164261.png" alt="img"> </p>
<hr>
<p>最终采纳了4000Hz  ,还是有一定噪音，最低占空比能到11%    </p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250120194322034-1166373335.png" alt="img"></p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250120200743357-258576323.png" alt="img"><br>串口发送数据，串口中断优先级要高于定时器中断优先级  </p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250120204320505-1353450636.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250120204628788-739176652.png" alt="img"><br>串口3可选择定时器2，定时器3  （波特率发生器）<br>串口4可选择定时器2，定时器4    </p>
<hr>
<p>懵逼了好久，原来是更新后的p33按键脚变成了p23<br>然后没反应过来<br>把p33外部中断了，那个灯一直闪，<br>一个个排除，还以为我程序没下进去  </p>
<hr>
<p>把核心板的串口焊出来了  </p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250121000442255-1331141141.png" alt="img"></p>
<h2 id="1-21"><a href="#1-21" class="headerlink" title="1.21"></a>1.21</h2><p>真服了，停电了  </p>
<hr>
<p>先写串口 类  </p>
<hr>
<pre><code>                42 10 08 3F 51 70 85 DF 42 10 08 3F 49 0F DB CC   
                42 10 08 3F 41 9D 7E F5 42 10 08 3F 3A 2B 20 1E   
                42 10 08 3F 2E FF 94 5A 42 10 08 3F 21 09 25 E8   
                42 10 08 3F 16 CB E4 5E 42 10 08 3F 0B A0 58 9C   
                42 10 08 3E FF 0D 02 A6 42 10 08 3E EC 6F 17 0A   
                42 10 08 3E D2 5E D0 98 42 10 08 3E B0 DC 2B 4F   
                42 10 08 3E AE FF 94 D9 42 10 08 3E 89 C3 C1 A5    
                42 10 08 3E 6E 4B AE FF 42 10 08 3E 7D 30 69 AE   
                42 10 08 3D E6 D9 52 A8 42 10 08 3D C9 0F DB 4A   
                42 10 08 3D 50 82 39 A2 42 10 08 3C 6E 4B AE FD   
</code></pre>
<hr>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>&#123;</span>                     <span class="comment">//发送帧就是一直在发送（编码测度）  接收帧就是匹配后再赋值给对应帧（打角，速度）</span></span><br><span class="line">    uint8 Header;                   <span class="comment">//帧头      （赋初值后不变）  </span></span><br><span class="line">    uint8 Addr;                     <span class="comment">//地址      （赋初值后不变）</span></span><br><span class="line">    uint8 Len;                      <span class="comment">//长度      （赋初值后不变）</span></span><br><span class="line">    uint8 Data[USB_FRAME_LENMAX];   <span class="comment">//数据      （一直在定时获取）</span></span><br><span class="line">    uint8 CheckSum;                 <span class="comment">//校验和    （一直在定时获取）</span></span><br><span class="line">&#125;UsbFrame;</span><br><span class="line"><span class="keyword">extern</span> UsbFrame Send_Encoder_Frame; <span class="comment">// 通讯帧结构体---发送编码器数据</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////串口同edgeboard通讯--通讯协议设置//////////////</span></span><br><span class="line">    Send_Encoder_Frame.Header=USB_FRAME_HEAD;</span><br><span class="line">    Send_Encoder_Frame.Addr=USB_ADDR_ENCODER;</span><br><span class="line">    Send_Encoder_Frame.Len=<span class="number">8</span>;<span class="comment">//头+地址+长度+4数据+校验和</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//////////////串口同edgeboard通讯--通讯协议设置//////////////</span></span><br></pre></td></tr></table></figure>
<p><em><strong>要考虑是大端序还是小端序</strong></em><br>大端序（Big-endian）：高位字节存储在低地址处，低位字节存储在高地址处。</p>
<p>小端序（Little-endian）：低位字节存储在低地址处，高位字节存储在高地址处。</p>
<p>ARM架构：大多数ARM处理器（如Cortex-M系列）使用小端序。^[1]^</p>
<p>AVR架构：AVR单片机（如ATmega系列）使用小端序。^[2]^</p>
<p>PIC架构：Microchip的PIC单片机通常使用小端序。^[3]^</p>
<p>x86架构：Intel和AMD的x86处理器使用小端序。^[4]^</p>
<p>某些DSP处理器：某些数字信号处理器（DSP）可能使用大端序，但这取决于具体的处理器型号。</p>
<hr>
<p>x86架构：Intel和AMD的x86处理器及其64位扩展（x86-64或AMD64）广泛使用小端序。这意味着在大多数基于x86的PC和服务器上运行的Linux系统也将使用小端序。</p>
<p>ARM架构：ARM处理器支持大端序和小端序，但大多数ARM处理器（包括用于移动设备和许多嵌入式系统的Cortex-A和Cortex-M系列）默认配置为小端序。因此，基于ARM的Linux系统（如Raspberry Pi、NVIDIA Jetson等）通常也使用小端序。</p>
<p>其他架构：其他硬件架构（如MIPS、PowerPC等）可能支持不同的字节序配置，但大多数现代处理器默认使用小端序或提供配置选项以支持小端序。</p>
<hr>
<p>回寝了</p>
<hr>
<p>只要两个结构体具有相同的类型和定义，就可以将一个结构体直接赋值给另一个结构体。这种赋值是浅拷贝，对于包含指针成员的结构体需要特别注意。</p>
<hr>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">switch</span> (fifo4_get_data[<span class="number">1</span>])</span><br><span class="line">            &#123;</span><br><span class="line">            <span class="keyword">case</span> USB_ADDR_HEART: <span class="comment">// 通信心跳(W)（上位机下发心跳信号（掉线检测周期3s））（通信连接后进入PID闭环速控模式，否则开环）（发送其他信号也可以当作修那条信号保持连接状态）</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 帧长4</span></span><br><span class="line">                uart_write_string(UART4_INDEX, <span class="string">&quot;USB_ADDR_HEART:</span></span><br><span class="line"><span class="string">&quot;</span>); <span class="comment">// 输出测试信息</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> USB_ADDR_CONTROL: <span class="comment">// 速度和方向控制（W）</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 帧长10</span></span><br><span class="line">                <span class="comment">// uart_write_string(UART4_INDEX, &quot;USB_ADDR_CONTROL:</span></span><br><span class="line"><span class="string">&quot;);											// 输出测试信息</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            break;</span></span><br><span class="line"><span class="string">            case USB_ADDR_SPEEDMODE: // 速控模式（W）：1开环，other闭环</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                // 帧长5</span></span><br><span class="line"><span class="string">                // uart_write_string(UART4_INDEX, &quot;</span>USB_ADDR_SPEEDMODE:</span><br><span class="line"><span class="string">&quot;);											// 输出测试信息</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            break;</span></span><br><span class="line"><span class="string">            case USB_ADDR_SERVOTHRESHOLD: // 舵机阈值（W/R）</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                // 帧长7</span></span><br><span class="line"><span class="string">                // uart_write_string(UART4_INDEX, &quot;</span>USB_ADDR_SERVOTHRESHOLD:</span><br><span class="line"><span class="string">&quot;);											// 输出测试信息</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            break;</span></span><br><span class="line"><span class="string">            case USB_ADDR_BUZZER: // 蜂鸣器音效（W）</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                // 帧长5</span></span><br><span class="line"><span class="string">                printf(&quot;</span>date:%x,%x,%x,%x,%x</span><br><span class="line"><span class="string">&quot;, fifo4_get_data[0], fifo4_get_data[1], fifo4_get_data[2], fifo4_get_data[3], fifo4_get_data[4]);</span></span><br><span class="line"><span class="string">                // uart_write_string(UART4_INDEX, &quot;</span>USB_ADDR_BUZZER:</span><br><span class="line"><span class="string">&quot;);											// 输出测试信息</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            break;</span></span><br><span class="line"><span class="string">            case USB_ADDR_LIGHT: // LED灯效（W）</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                // 帧长8</span></span><br><span class="line"><span class="string">                // uart_write_string(UART4_INDEX, &quot;</span>USB_ADDR_LIGHT:</span><br><span class="line"><span class="string">&quot;);											// 输出测试信息</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            break;</span></span><br><span class="line"><span class="string">            case USB_ADDR_KEYINPUT: // 按键信息（R）</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                // 帧长6</span></span><br><span class="line"><span class="string">                // uart_write_string(UART4_INDEX, &quot;</span>USB_ADDR_KEYINPUT:</span><br><span class="line"><span class="string">&quot;);											// 输出测试信息</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            break;</span></span><br><span class="line"><span class="string">            case USB_ADDR_BATTERY: // 电池信息（R）</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">                // 帧长9</span></span><br><span class="line"><span class="string">                // uart_write_string(UART4_INDEX, &quot;</span>USB_ADDR_BATTERY:</span><br><span class="line"><span class="string">&quot;);											// 输出测试信息</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">            break;</span></span><br><span class="line"><span class="string">            default:</span></span><br><span class="line"><span class="string">                break;</span></span><br><span class="line"><span class="string">            &#125;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">Z[判断临时帧的帧头是否为0] --&gt;Y&#123;判断是否接收到正确帧&#125;</span><br><span class="line">Y --&gt;|为0| A1[未接收到正确帧_num++]</span><br><span class="line">A1 --&gt;X&#123;判断错误帧计数器num是否大于x&#125;</span><br><span class="line">	X --&gt;|小于x| O[不给电机舵机赋值_保持上一次的值]</span><br><span class="line">	X --&gt;|大于等于x| P[停车_num大于0]</span><br><span class="line">Y --&gt;|为0x42| A[接收到正确帧]</span><br><span class="line">A --&gt;B&#123;判断错误帧计数器num是否大于x&#125;</span><br><span class="line">    B --&gt;|小于x| C[正确接收数据_num清零]  </span><br><span class="line">    B --&gt;|大于等于x| P  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<p>很好，上位机发给下位机的大小端是反的<br>但是为什么前面下位机发给上位机的编码器是正确的<br>待会重新测一下    </p>
<hr>
<p>舵机突然挂了<br>测了好久没测出来<br>电压不够<br>带上去还是不够<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250121233657565-1587753609.png" alt="img">  </p>
<hr>
<p>死区的原因<br>需要一步一步转过去  </p>
<hr>
<p>okk<br>我觉得舵机的问题已经彻底解决了  </p>
<h2 id="1-22"><a href="#1-22" class="headerlink" title="1.22"></a>1.22</h2><hr>
<p>BUTTON(按下为1，松开是0)<br>A–number:0<br>B–number:1<br>X–number:3<br>Y–number:4<br>L上–number:6<br>R上–number:7<br>L下–number:8（同时是AXIS）(松开是0，刚开始按下是1)<br>R下–number:9（同时是AXIS）(松开是0，刚开始按下是1)<br>logo左方按钮—number:10<br>logo右方按钮—number:11  </p>
<hr>
<p>AXIS(-32767~32767)<br>左摇杆X轴（从左到右）—number:0<br>左摇杆Y轴（从上到下）—number:1<br>右摇杆X轴（从左到右）—number:2<br>右摇杆Y轴（从上到下）—number:3<br>方向键左（按下-32767,松开0）—number:6<br>方向键右（按下32767,松开0） —number:6<br>方向键上（按下-32767,松开0）—number:7<br>方向键下（按下32767,松开0） —number:7</p>
<hr>
<p>这个舵机，，，还需要研究研究<br>没电了  </p>
<hr>
<p>11111111000000000000000111111100000000000011111100000000000000<br>8  15  7  12  6  14</p>
<hr>
<p>11100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111000000000000000111111100000000000011111100000000000000111111110000000000000001111111000000000000111111000000000000001111111100000000000000011111110000000000001111110000000000000011111111</p>
<hr>
<p>逐飞的布丁真不行，一上来就撇责任给软件，我单一对照实验做给你看非要我展示pwm，一般  </p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250122191034656-1337419418.png" alt="img"></p>
<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">                    </span><br><span class="line">[21:42:08.155]接收←speed_pwm:0.000000</span><br><span class="line">                    Receibve_Speed:00_00_00_00</span><br><span class="line">                    servo_pwm:130.000000</span><br><span class="line">                    Receibve_Servo:00_00_02_43</span><br><span class="line">                    </span><br><span class="line">[21:42:08.525]接收←speed_pwm:0.000000</span><br><span class="line">                    Receibve_Speed:00_00_00_00</span><br><span class="line">                    servo_pwm:130.000000</span><br><span class="line">                    Receibve_Servo:00_00_02_43</span><br><span class="line">                    speed_pwm:0.000000</span><br><span class="line">                    Receibve_Speed:00_00_00_00</span><br><span class="line">                    servo_pwm:130.000000</span><br><span class="line">                    Receibve_Servo:00_00_02_43</span><br><span class="line">                    </span><br><span class="line">[21:42:08.566]接收←speed_pwm:0.000000</span><br><span class="line">                    Receibve_Speed:00_00_00_00</span><br><span class="line">                    servo_pwm:130.000000</span><br><span class="line">                    Receibve_Servo:00_00_02_43</span><br></pre></td></tr></table></figure>
<p>第一次：7139<br>第二次：1281</p>
<hr>
<h2 id="1-23"><a href="#1-23" class="headerlink" title="1.23"></a>1.23</h2><p>第一件事：先把通信整完，把其他中断打开看还有没有问题  </p>
<hr>
<p>这是下载时串口接收的数据，一直在重复发送46 B9 68 00 08 02 54 00 C6 16，最后发送了46 B9 68 00 08 04 54 00 C8 16 00 00</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 02 54 00 C6 16 46 B9 68 00 08 04 54 00 C8 16 00 00 </span><br></pre></td></tr></table></figure>


<hr>
<p>串口能正常接收，但是读取不对<br>好吧，串口接收不正常<br>不对，中间基本都是正常的<br>偶尔会有一两帧出错，还是需要加上长度检验？  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">30 2C 53 65 72 76 6F 5F 56 61 6C 75 65 3A 31 34 33 36 36 35 35 34 38 36 38 39 30 35 39 32 30 30 30 30 30 30 30 2E 30 30 30 30 30 30 0D 0A 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 4D 6F 74 6F 72 5F 56 61 6C 75 65 3A 30 2E 30 30 30 30 30 30 2C 53 65 72 76 6F 5F 56 61 6C 75 65 3A 39 30 2E 30 30 30 30 30 30 0D 0A 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 4D 6F 74 6F 72 5F 56 61 6C 75 65 3A 30 2E 30 30 30 30 30 30 2C 53 65 72 76 6F 5F 56 61 6C 75 65 3A 39 30 2E 30 30 30 30 30 30 0D 0A 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 4D 6F 74 6F 72 5F 56 61 6C 75 65 3A 30 2E 30 30 30 30 30 30 2C 53 65 72 76 6F 5F 56 61 6C 75 65 3A 30 2E 30 30 30 30 30 30 0D 0A 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 4D 6F 74 6F 72 5F 56 61 6C 75 65 3A 30 2E 30 30 30 30 30 30 2C 53 65 72 76 6F 5F 56 61 6C 75 65 3A 35 37 2E 30 36 34 38 33 35 0D 0A 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 4D 6F 74 6F 72 5F 56 61 6C 75 65 3A 30 2E 30 30 30 30 30 30 2C 53 65 72 76 6F 5F 56 61 6C 75 65 3A 30 2E 30 30 30 30 30 30 0D 0A B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 00 00 00 00 00 B4 42 64 42 20 0C 00 </span><br></pre></td></tr></table></figure>
<hr>
<p>长度 26                          15长度16<br>0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25<br>            i<br>            0 1 2 3 4 5 6 7 8 9 10 11<br>            帧头<br>            i&#x3D;6;16&#x3D;i+10  </p>
<hr>
<p>i+0 i+1 i+2   i+3 i+4 i+5 i+6     i+7 i+8 i+9 i+10     i+11 (12个数字)<br>从0 到 i+11 总共i+12个数字</p>
<hr>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">      <span class="comment">//uart_write_byte(UART1, fifo4_get_data[i]); // 将读取到的数据发送出去</span></span><br><span class="line">                <span class="keyword">if</span>(fifo4_get_data[i]==USB_FRAME_HEAD&amp;&amp;fifo4_data_count&gt;=(i+<span class="number">12</span>))<span class="comment">//找到帧头同时判断fifo剩余数据长度长于一帧</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span>(fifo4_get_data[i+<span class="number">1</span>]==USB_ADDR_CONTROL&amp;&amp;fifo4_get_data[i+<span class="number">2</span>]==<span class="number">0x0C</span>&amp;&amp;fifo4_get_data[i+<span class="number">11</span>]==USB_ADDR_CONTROL_TAIL)</span><br><span class="line">                    &#123;</span><br><span class="line">                        data_ptr=fifo4_get_data+i+<span class="number">3</span>; <span class="comment">//将数据指针指向</span></span><br><span class="line">                        ReverseBytesAndStoreAsFloat(data_ptr,&amp;InterDeviceParams.Motor_Value);</span><br><span class="line">                        data_ptr=fifo4_get_data+i+<span class="number">7</span>; <span class="comment">//将数据指针指向</span></span><br><span class="line">                        ReverseBytesAndStoreAsFloat(data_ptr,&amp;InterDeviceParams.Servo_Value);</span><br><span class="line">                        <span class="built_in">printf</span>(<span class="string">&quot;Motor:%f,Servo:%f</span></span><br><span class="line"><span class="string">&quot;</span>,InterDeviceParams.Motor_Value,InterDeviceParams.Servo_Value);</span><br><span class="line">                    &#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>解决了通讯延时慢的问题，是我代码的问题，逐飞用的是fifo缓冲存储式的方式，我照搬usb帧的解析成功识别率比较低。  </p>
<hr>
<p>屏幕能正常使用<br>由于我使用的是我之前自行购买的169屏幕，和逐飞的114和200都不一样，显示区域需要偏移</p>
<ol>
<li>正常竖屏，最终y轴向下偏移20个像素点</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(ips169_display_dir==IPS169_PORTAIT)</span><br><span class="line">&#123;</span><br><span class="line">    ips169_write_index(<span class="number">0x2a</span>);                                               <span class="comment">// 列地址设置</span></span><br><span class="line">    ips169_write_16bit_data(x1);</span><br><span class="line">    ips169_write_16bit_data(x2);</span><br><span class="line">    ips169_write_index(<span class="number">0x2b</span>);                                               <span class="comment">// 行地址设置</span></span><br><span class="line">    ips169_write_16bit_data(y1+<span class="number">20</span>);</span><br><span class="line">    ips169_write_16bit_data(y2+<span class="number">20</span>);</span><br><span class="line">    ips169_write_index(<span class="number">0x2c</span>);                                               <span class="comment">// 储存器写</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<ol start="2">
<li><p>反转横屏<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250123215356739-1743824197.jpg" alt="img"><br>红色区域是未偏移<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250123215524169-1911880911.jpg" alt="img"><br>蓝色区域是x轴偏移20个像素点后的效果<br>也就是说x轴还得继续向右偏移<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250123220016620-1284821433.jpg" alt="img"><br>x轴向右偏移50后，左边没有完全覆盖？甚么道理，横屏没法全部覆盖<br>怀疑是宽高没有随方向变化的问题，逐飞写了但是注释了，不知道为什么<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250123221039454-512626546.jpg" alt="img"><br>将宽高随方向变化后，x轴偏移50，目前不能确定，把颜色改一下再看看<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250123221336433-1050113142.jpg" alt="img"><br>宽高正确后未偏移的效果<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250123221607432-1853088420.jpg" alt="img"><br>成了，宽高正确后，x轴偏移20</p>
</li>
<li><p>反转竖屏<br>同正常竖屏  </p>
</li>
<li><p>正常横屏<br>同反转横屏</p>
</li>
</ol>
<hr>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">横屏完全覆盖---8*16字体</span></span><br><span class="line"><span class="comment">		for(i=0;i&lt;35;i++)</span></span><br><span class="line"><span class="comment">		&#123;</span></span><br><span class="line"><span class="comment">			for(j=0;j&lt;15;j++)</span></span><br><span class="line"><span class="comment">			&#123;</span></span><br><span class="line"><span class="comment">				ips169_show_char(i*8,j*16,&#x27;A&#x27;+i);</span></span><br><span class="line"><span class="comment">			&#125;</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment">由于使用的屏幕是圆角的，所以四个角显示不完全</span></span><br><span class="line"><span class="comment">（x,y）(第y行第x列)</span></span><br><span class="line"><span class="comment">起点是以下的8*16显示不完全（横屏）</span></span><br><span class="line"><span class="comment">（0，0） （8，0）  （16，0）-----------------------------------------------------（256，0）  （264，0）  (272,0)  </span></span><br><span class="line"><span class="comment">（0，16）--------------------------------------------------------------------------------------------（272，16）   </span></span><br><span class="line"><span class="comment">    -                                                                                                     -</span></span><br><span class="line"><span class="comment">    -                                                                                                     -</span></span><br><span class="line"><span class="comment">    -                                                                                                     -</span></span><br><span class="line"><span class="comment">    -                                                                                                     -</span></span><br><span class="line"><span class="comment">    -                                                                                                     -</span></span><br><span class="line"><span class="comment">    -                                                                                                     -</span></span><br><span class="line"><span class="comment">（0，208）------------------------------------------------------------------------------------------（272，208） </span></span><br><span class="line"><span class="comment">（0，224）（8，224）（16，224）-------------------------------------------------（256，224）（264，224）(272,224)  </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">总结如下：</span><br><span class="line"></span><br><span class="line">data: 0.0082KB</span><br><span class="line"></span><br><span class="line">edata+hdata: 0.2578KB</span><br><span class="line"></span><br><span class="line">xdata: 6.5283KB</span><br><span class="line"></span><br><span class="line">const: 3.2441KB</span><br><span class="line"></span><br><span class="line">code: 38.6292KB</span><br></pre></td></tr></table></figure>
<p>NET-{20ADAEED-0290-494E-AA80-3B8B25A563C8}-088E901C681B</p>
<hr>
<p>0<br>16  1<br>32  2<br>48  3<br>64   &#x3D;16*(3+1)</p>
<hr>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">(0,0)   （24，0）   （48，0）   （72，0）   （96，0)    (120,0)     (144,0)     (168,0)    (192,0)  </span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">0   24  48  72  96   120    144    168    192   216   240   </span></span><br><span class="line"><span class="comment">24</span></span><br><span class="line"><span class="comment">48</span></span><br><span class="line"><span class="comment">72</span></span><br><span class="line"><span class="comment">96</span></span><br><span class="line"><span class="comment">120</span></span><br><span class="line"><span class="comment">144</span></span><br><span class="line"><span class="comment">168</span></span><br><span class="line"><span class="comment">192</span></span><br><span class="line"><span class="comment">216</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>0 24 48 72+8*4</p>
<hr>
<p>Program Size: data&#x3D;8.4 edata+hdata&#x3D;264 xdata&#x3D;6797 const&#x3D;3467 code&#x3D;41554<br>放图片前<br>Program Size: data&#x3D;8.4 edata+hdata&#x3D;264 xdata&#x3D;6797 const&#x3D;3467 code&#x3D;49962<br>放图片后</p>
<h2 id="1-24"><a href="#1-24" class="headerlink" title="1.24"></a>1.24</h2><p>连上屏幕后就出问题了，舵机转不动<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124181045014-437677463.png" alt="img"></p>
<hr>
<p>临时杜邦线连核心板的5V供电，勉强能用  </p>
<hr>
<p>采样完了普通赛道  </p>
<hr>
<p>回去睡了一觉，醒来先赶着天亮把一些特殊赛道采样了下<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124181234599-1769253669.jpg" alt="img"><br>这个200cm我觉得是真大了，严重怀疑虚标<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124181302131-510446308.jpg" alt="img"><br>这个采了，<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124181317836-2032845170.jpg" alt="img"><br>这个没采，我觉得这个可能是斜着的，没确定，觉得有点麻烦<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124181349201-423186138.jpg" alt="img"><br>没找着锥桶，而且这个需要ai吧，先看看，看能不能“三值化”<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124181437298-792775496.jpg" alt="img"><br>这个经典，采了<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124181452165-827910632.jpg" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124181458079-1686693848.jpg" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124181503600-1715621573.jpg" alt="img"><br>我刚刚实测了一下，按这个电压用核心板上的供电的方法，舵机和屏幕都正常  </p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124202829586-614425465.png" alt="img"></p>
<hr>
<p>舵机的瞬时电流很大，会触发电源芯片的过流保护    </p>
<hr>
<p>需要设置的标志位,上电后首先从eeprom读取上次的残留值，如果成功与上位机通信则再获取上位机的设定值<br>是否开启舵机（1开启，0关闭）<br>是否开启电机（1开启，0关闭）&#x2F;&#x2F;可以手动，所以始终置为1<br>是否发送编码器读取值的标志位（1开启，0关闭）<br>是否发送陀螺仪数据的标志位（1开启，0关闭）（没写，实际就是关闭）<br>是否开启debug模式（从串口四接收的数据会全部打印在串口1（纯粹数据流打印））（1开启，0关闭）<br>是否接收遥控器返回值作为按键输入值的标志位（1接收，0不接收）</p>
<hr>
<p>从上位机获取的标志位：<br>是否与上位机成功联通的标志位（及时接收到心脏信号就是1，长时间没有接收到心脏信号就是0）（这个不用从eeprom中读取，初始为0）  </p>
<hr>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// AI8051U-34K64内部的RAM分为:</span></span><br><span class="line"><span class="comment">// 2K字节内部SRAM(EDATA)</span></span><br><span class="line"><span class="comment">// 32K字节内部RAM(XDATA)</span></span><br><span class="line"><span class="comment">// 64K字节的FLASH</span></span><br><span class="line"></span><br><span class="line">int8 test1[<span class="number">10</span>] = &#123;<span class="number">0</span>&#125;;			<span class="comment">//将变量存入EDATA区域</span></span><br><span class="line">int8 edata test2[<span class="number">10</span>] = &#123;<span class="number">0</span>&#125;;		<span class="comment">//将变量存入EDATA区域</span></span><br><span class="line">int8 xdata test3[<span class="number">10</span>] = &#123;<span class="number">0</span>&#125;;		<span class="comment">//将变量存入XDATA区域</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//内部拥有128K的FALSH</span></span><br><span class="line">int8 code test4[<span class="number">10</span>] = &#123;<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>&#125;;	<span class="comment">//将常量存入FLASH区域</span></span><br></pre></td></tr></table></figure>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124213857278-101463945.png" alt="img"></p>
<hr>
<p>eeprom<br>如果清除了扇区，则所有的数据都被清除了<br>读取的都是0XFF<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124220520442-1003241286.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124220536910-1660724255.png" alt="img"><br>eeprom下载时的相关设定<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124220621875-1289894835.png" alt="img"></p>
<hr>
<p>接下来尝试不擦除扇区的情况下写入数据<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124221248381-1299913079.png" alt="img"><br>写入出错，想要成功写入必须先擦除扇区，看看手册<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124221650994-960444146.png" alt="img"><br>手册说明如此<br>以字节为单位进行读写<br>以512字节的扇区为页进行擦除<br>原因如下：<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124221843181-1875086227.png" alt="img"><br>只能从0写1，不能从1写0，<br>解决办法：程序进入后，先将需要保留的数据读出，然后擦除整个扇区，再将数据写回<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124222124215-1301321992.png" alt="img"><br>eeprom在64k的存储空间中<br>结束地址时钟是FF:FFFFh<br>1K是1024是两个512，就是两个扇区<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124222405525-888717909.png" alt="img">  </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//逐飞擦除扇区的例程函数</span></span><br><span class="line"><span class="comment">//-------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">//  @brief      EEPROM擦除目标地址所在的一页（1扇区/512字节）</span></span><br><span class="line"><span class="comment">//  @param      addr			需要写的eeprom地址</span></span><br><span class="line"><span class="comment">//  @return     void</span></span><br><span class="line"><span class="comment">//  Sample usage:       		iap_erase_page(0x20);</span></span><br><span class="line"><span class="comment">//								擦除0x00-0x200的数据</span></span><br><span class="line"><span class="comment">//-------------------------------------------------------------------------------------------------------------------</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">iap_erase_page</span><span class="params">(uint32 addr)</span></span><br><span class="line">&#123;</span><br><span class="line">	bit flag = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	flag = EA;</span><br><span class="line">	EA = <span class="number">0</span>;</span><br><span class="line">    IAP_CMD = <span class="number">3</span>; 				<span class="comment">//设置 IAP 擦除命令</span></span><br><span class="line">    IAP_ADDRL = addr; 			<span class="comment">//设置 IAP 低地址</span></span><br><span class="line">    IAP_ADDRH = addr &gt;&gt; <span class="number">8</span>;  	<span class="comment">//设置 IAP 高地址</span></span><br><span class="line">    IAP_ADDRE = addr &gt;&gt; <span class="number">16</span>;		<span class="comment">//设置 IAP 最高地址</span></span><br><span class="line">    eeprom_trig();</span><br><span class="line">    </span><br><span class="line">   	EA = flag;</span><br><span class="line">    system_delay_ms(<span class="number">10</span>);		<span class="comment">//擦除1扇区(512字节)：约4-6ms</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>从上图可以看出iap读取写入的地址是从0:0000h到0：03ffh—–&gt;就是从0到1023（3<em>16</em>16+15*16+15）<br>说明两个扇区，一个是从地址0到地址511，另一个是从地址512到地址1023<br>实际实验一下，我擦除iap_erase_page(512);看是否不影响第一个扇区<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250124224004991-287203804.png" alt="img"><br>未写入，擦除，数值没变化，说明是两个扇区了。    </p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250125000226279-1766031866.jpg" alt="img"><br>是菜单序列表写错了，没有退出条件，给芯片干懵逼了，盲猜从21加到255再回到0  </p>
<hr>
<p>旧：<br>进来直接判断新旧页面是否相等来判断更新，不适用<br>新：<br>定义一个const flag&#x3D;0;<br>今来先判断flag<br>如果是0，则说明页面需要更新，<br>       先判断last_num和当前num是否相等，<br>            如果不相等则先按普通逻辑更新一波<br>                 再判断功能符是否为2或者3，如果是2或者3则显示01值<br>                                         如果不是则不显示01值<br>            如果相等<br>                再判断功能符是否为2或者3，如果是2或者3则显示01值<br>                                         如果不是则不显示01值</p>
<p>进来先判断flag<br>如果是0，则说明页面需要更新，<br>    先判断last_num和当前num是否相等，<br>        如果不相等则先按普通逻辑更新一波</p>
<pre><code>再判断功能符是否为2或者3，如果是2或者3则显示01值
    如果不是则不显示01值
</code></pre>
<p>如果是1，则说明页面不需要更新</p>
<hr>
<p>47 72 6F 75 70 5F 46 6C 61 67 5B 30 5D 3A 30 63<br>0D 0A 47 72 6F 75 70 5F 46 6C 61 67 5B 30 5D 3A<br>30 63 0D 0A 47 72 6F 75 70 5F 46 6C 61 67 5B 30<br>5D 3A 30 63 0D 0A 47 72 6F 75 70 5F 46 6C 61 67<br>5B 30 5D 3A 30 63 0D 0A 47 72 6F 75 70 5F 46 6C<br>61 67 5B 30 5D 3A 30 63 0D 0A 47 72 6F 75 70 5F<br>46 6C 61 67 5B 30 5D 3A 30 63 0D 0A 47 72 6F 75<br>70 5F 46 6C 61 67 5B 30 5D 3A 30 63 0D 0A 47 72<br>6F 75 70 5F 46 6C 61 67 5B 30 5D 3A 30 63 0D 0A<br>47 72 6F 75 70 5F 46 6C 61 67 5B 30 5D 3A 30 63<br>0D 0A 47 72 6F 75 70 5F 46 6C 61 67 5B 30 5D 3A<br>30 63 0D 0A 47 72 6F 75 70 5F 46 6C 61 67 5B 30<br>5D 3A 30 63 0D 0A 47 72 6F 75 70 5F 46 6C 61 67<br>5B 30 5D 3A 30 63 0D 0A 47 72 6F 75 70 5F 46 6C<br>61 67 5B 30 5D 3A 30 63 0D 0A 47 72 6F 75 70 5F<br>46 6C 61 67 5B 30 5D 3A 30 63 0D 0A 47 72 6F 75<br>70 5F 46 6C 61 67 5B 30 5D 3A 30 63 0D 0A 47 72<br>6F 75 70 5F 46 6C 61 67 5B 30 5D 3A 30 63 0D 0A<br>47 72 6F 75 70 5F 46 6C 61 67 5B 30 5D 3A 30 63<br>0D 0A 47 72 6F 75 70 5F 46 6C 61 67 5B 30 5D 3A<br>30 63 0D 0A 47 72 6F 75 70 5F 46 6C 61 67 5B 30<br>5D 3A 30 63 0D 0A 47 72 6F 75 70 5F 46 6C 61 67<br>5B 30 5D 3A 30 63 0D 0A 47 72 6F 75 70 5F 46 6C<br>61 67 5B 30 5D 3A 30 63 0D 0A 47 72 6F 75 70 5F<br>46 6C 61 67 5B 30 5D 3A 30 63 0D 0A 47 72 6F 75<br>70 5F 46 6C 61 67 5B 30 5D 3A 30 63 0D 0A 47 72<br>6F 75 70 5F 46 6C 61 67 5B 30 5D 3A 30 63 0D 0A<br>47 72 6F 75 70 5F 46 6C 61 67 5B 30 5D 3A 30 63<br>0D 0A 47 72 6F 75 70 5F 46 6C 61 67 5B 30 5D 3A </p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250125031130337-1635724333.png" alt="img"><br>变了!!!  </p>
<hr>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 脚本名称</span></span><br><span class="line">SCRIPT_NAME=$(<span class="built_in">basename</span> <span class="string">&quot;<span class="variable">$0</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查参数数量</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$#</span>&quot;</span> -ne 1 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;使用方法: <span class="variable">$SCRIPT_NAME</span> &lt;参数&gt;&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;参数可以是:&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;  1 - 跳转到第一个目录&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;  2 - 跳转到第二个目录&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据参数执行不同的操作</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$1</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">    1)</span><br><span class="line">        TARGET_DIR=<span class="string">&quot;/root/workspace/sasu_icar2024_demo/build/&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    2)</span><br><span class="line">        TARGET_DIR=<span class="string">&quot;/root/workspace/sasu_icar2024_demo/res/samples/train/&quot;</span></span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;未知参数: <span class="variable">$1</span>&quot;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&quot;请使用 <span class="variable">$SCRIPT_NAME</span> 1 或 <span class="variable">$SCRIPT_NAME</span> 2&quot;</span></span><br><span class="line">        <span class="built_in">exit</span> 1</span><br><span class="line">        ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 跳转到目标目录</span></span><br><span class="line"><span class="keyword">if</span> [ -d <span class="string">&quot;<span class="variable">$TARGET_DIR</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">cd</span> <span class="string">&quot;<span class="variable">$TARGET_DIR</span>&quot;</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;已成功跳转到目录: <span class="variable">$TARGET_DIR</span>&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;目录不存在: <span class="variable">$TARGET_DIR</span>&quot;</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="built_in">exec</span> bash</span><br></pre></td></tr></table></figure>
<p>一个用来跳转的bash<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250125043438057-1194407883.png" alt="img"></p>
<h2 id="1-25"><a href="#1-25" class="headerlink" title="1.25"></a>1.25</h2><hr>
<ol>
<li>命令行清除一个文件里面的内容（linux）:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; filename</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>删除Linux的history记录</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; ~/.bash_history</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>exec bash</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">exec：这是一个内建命令，用于替换当前shell进程。当您使用exec执行一个命令时，当前的shell进程会被新命令的进程所替换。这意味着，一旦新命令执行完毕，它不会返回到原来的shell，而是直接退出。</span><br><span class="line"></span><br><span class="line">当您输入exec bash时，您实际上是在告诉系统用一个新的bash进程替换当前的shell进程。这通常用于以下几种情况：</span><br><span class="line"></span><br><span class="line">启动一个新的bash会话：当您想从一个非bash的shell环境切换到bash时，可以使用exec bash。</span><br><span class="line"></span><br><span class="line">修复损坏的shell环境：有时shell环境可能会因为某些原因而损坏，使用exec bash可以启动一个新的、干净的bash会话。</span><br><span class="line"></span><br><span class="line">脚本中的用途：在shell脚本中，exec bash可以用于确保脚本的剩余部分在一个新的bash环境中执行，这对于脚本的兼容性和稳定性可能是有益的。</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>查看linux进程</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#这个命令会列出所有用户的所有进程，包括进程ID、CPU使用率、内存使用率、进程状态等信息。</span></span><br><span class="line">ps aux</span><br><span class="line"></span><br><span class="line"><span class="comment">#htop提供了类似top的功能，但具有更友好的用户界面和更多的交互选项。例如，您可以使用箭头键在进程之间导航，并使用F9键杀死进程。同样，您可以通过按F10键退出htop界面。</span></span><br><span class="line">htop(edgeboard中没有)</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行这个命令后，您将看到一个实时更新的进程列表。默认情况下，它会按CPU使用率排序。您可以通过按q键退出top界面。</span></span><br><span class="line">top</span><br></pre></td></tr></table></figure>
<p>实际情况如下：<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250125182944406-982501107.png" alt="img"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">root@paddlepi:~# ps aux</span><br><span class="line">USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root         1  5.0  0.2 162348  9308 ?        Ss   21:12   0:08 /sbin/init</span><br><span class="line">root         2  0.0  0.0      0     0 ?        S    21:12   0:00 [kthreadd]</span><br><span class="line">root         3  0.0  0.0      0     0 ?        I    21:12   0:00 [kworker/0:0]</span><br><span class="line">root         4  0.0  0.0      0     0 ?        I&lt;   21:12   0:00 [kworker/0:0H]</span><br><span class="line">root         5  0.0  0.0      0     0 ?        I    21:12   0:00 [kworker/u16:0]</span><br><span class="line">root         6  0.0  0.0      0     0 ?        I&lt;   21:12   0:00 [mm_percpu_wq]</span><br><span class="line">root         7  0.0  0.0      0     0 ?        R    21:12   0:00 [ksoftirqd/0]</span><br><span class="line"></span><br><span class="line">root      5295  0.0  0.0   5340  2644 ?        Ss   21:13   0:00 /usr/sbin/cron -f</span><br><span class="line">root      5298  0.1  0.2  17764  8048 ?        Ss   21:13   0:00 /usr/sbin/cupsd -l</span><br><span class="line">root      5300  0.3  0.4  99408 16696 ?        Ssl  21:13   0:00 /usr/bin/python3 /usr/bin/networkd-dispatcher --run-startup-triggers</span><br><span class="line">root      5302  0.8  0.0   5332  3164 ?        Ss   21:13   0:01 /bin/bash /usr/bin/wifi-s.sh</span><br><span class="line">root      5306  0.3  0.0  10184   512 ?        Ssl  21:13   0:00 /usr/bin/powerd</span><br><span class="line">root      5314  0.3  0.1 230016  5388 ?        Ssl  21:13   0:00 /usr/sbin/iio-sensor-proxy</span><br><span class="line">root      5318  1.0  0.3 743704 14620 ?        Ssl  21:13   0:01 /usr/lib/udisks2/udisksd</span><br><span class="line">root      5323  0.7  0.2 313608  9460 ?        Ssl  21:13   0:01 /usr/sbin/ModemManager --filter-policy=strict</span><br><span class="line">avahi     5324  0.2  0.0   6192  3180 ?        Ss   21:13   0:00 avahi-daemon: running [paddlepi.local]</span><br><span class="line">avahi     5354  0.0  0.0   5968   340 ?        S    21:13   0:00 avahi-daemon: <span class="built_in">chroot</span> helper</span><br><span class="line">root      5375  0.3  0.2 235884  7992 ?        Ssl  21:13   0:00 /usr/lib/accountsservice/accounts-daemon</span><br><span class="line">root      5382  0.2  0.1  10360  5048 ?        Ss   21:13   0:00 /lib/systemd/systemd-logind</span><br><span class="line">message+  5396  5.0  0.1   8404  5504 ?        Ss   21:13   0:08 /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --</span><br><span class="line">root      5484  6.5  0.4 404428 19176 ?        Ssl  21:13   0:10 /usr/sbin/NetworkManager --no-daemon</span><br><span class="line">mosquit+  5557  0.1  0.1   7704  4936 ?        S    21:13   0:00 /usr/sbin/mosquitto -c /etc/mosquitto/mosquitto.conf</span><br><span class="line">root      5564  0.4  0.2 236568  9844 ?        Ssl  21:13   0:00 /usr/lib/policykit-1/polkitd --no-debug</span><br><span class="line"></span><br><span class="line">root      5780  0.1  0.0      0     0 ?        I&lt;   21:13   0:00 [kworker/u17:3]</span><br><span class="line">root      5791  0.1  0.1   9772  6852 ?        Ss   21:13   0:00 /sbin/wpa_supplicant -u -s -O /run/wpa_supplicant</span><br><span class="line">xrdp      5812  0.0  0.0   7728   580 ?        S    21:13   0:00 /usr/sbin/xrdp</span><br><span class="line">root      5936  0.0  0.1   8368  5580 ?        S    21:13   0:00 /sbin/dhclient -d -q -sf /usr/lib/NetworkManager/nm-dhcp-helper -pf /run/dhclient-wlan0.pid -</span><br><span class="line">root      5961  0.1  0.2  33660 11048 ?        Ss   21:13   0:00 /usr/sbin/nmbd --foreground --no-process-group</span><br><span class="line">whoopsie  5964  0.0  0.3 247952 11844 ?        Ssl  21:13   0:00 /usr/bin/whoopsie -f</span><br><span class="line">root      5983  0.8  1.7 1737832 66028 ?       Ssl  21:13   0:01 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br><span class="line">kernoops  5986  0.0  0.0   9476   428 ?        Ss   21:13   0:00 /usr/sbin/kerneloops --<span class="built_in">test</span></span><br><span class="line">root      6912  0.0  0.2 238404  8924 ?        Sl   21:13   0:00 /usr/lib/gnome-online-accounts/goa-identity-service</span><br><span class="line">root      6914  0.0  0.1 230528  5208 ?        Ssl  21:13   0:00 /usr/lib/gvfs/gvfs-goa-volume-monitor</span><br><span class="line">root      6925  0.0  0.1 230408  5500 ?        Ssl  21:13   0:00 /usr/lib/gvfs/gvfs-mtp-volume-monitor</span><br><span class="line">root      7037  0.0  0.2 332112 11448 ?        Sl   21:13   0:00 /usr/lib/gnome-settings-daemon/gsd-printer</span><br><span class="line">root      7052  0.0  0.1 229856  6428 ?        Sl   21:13   0:00 /usr/lib/gnome-disk-utility/gsd-disk-utility-notify</span><br><span class="line">root      7065  2.7  1.4 763888 56196 ?        Sl   21:13   0:03 nautilus-desktop</span><br><span class="line">root      7071  0.1  0.2 310880  8952 ?        Sl   21:13   0:00 /usr/lib/aarch64-linux-gnu/indicator-messages/indicator-messages-service</span><br><span class="line">root      7091  0.1  0.2 310928  8876 ?        Sl   21:13   0:00 /usr/lib/gvfs/gvfsd-trash --spawner :1.7 /org/gtk/gvfs/exec_spaw/0</span><br><span class="line">root      7120  0.6  1.6 850816 61864 ?        Sl   21:13   0:00 /usr/lib/evolution/evolution-calendar-factory-subprocess --factory all --bus-name org.gnome.e</span><br><span class="line">root      7135  0.1  0.6 518732 23468 ?        Ssl  21:13   0:00 /usr/lib/evolution/evolution-addressbook-factory</span><br><span class="line">root      7136  0.0  0.1 160400  6956 ?        Sl   21:13   0:00 /usr/lib/ibus/ibus-engine-simple</span><br><span class="line">root      7152  0.2  0.6 813560 25908 ?        Sl   21:13   0:00 /usr/lib/evolution/evolution-addressbook-factory-subprocess --factory all --bus-name org.gnom</span><br><span class="line">root      7214  0.0  0.0      0     0 ?        I&lt;   21:13   0:00 [ext4-rsv-conver]</span><br><span class="line">root      7216  0.0  0.0      0     0 ?        I&lt;   21:13   0:00 [ext4-rsv-conver]</span><br><span class="line">root      7217  0.0  0.0      0     0 ?        S    21:13   0:00 [jbd2/mmcblk0p37]</span><br><span class="line">root      7220  0.0  0.0      0     0 ?        I&lt;   21:13   0:00 [ext4-rsv-conver]</span><br><span class="line">root      7222  0.0  0.0      0     0 ?        S    21:13   0:00 [jbd2/mmcblk0p1-]</span><br><span class="line">root      7223  0.0  0.0      0     0 ?        I&lt;   21:13   0:00 [ext4-rsv-conver]</span><br><span class="line">root      7225  0.0  0.0      0     0 ?        S    21:13   0:00 [jbd2/mmcblk0p29]</span><br><span class="line">root      7226  0.0  0.0      0     0 ?        I&lt;   21:13   0:00 [ext4-rsv-conver]</span><br><span class="line">root      7236  0.0  0.0      0     0 ?        S    21:13   0:00 [jbd2/mmcblk0p31]</span><br><span class="line">root      7237  0.0  0.0      0     0 ?        I&lt;   21:13   0:00 [ext4-rsv-conver]</span><br><span class="line">root      7464  0.0  0.0      0     0 ?        I    21:14   0:00 [kworker/1:4]</span><br><span class="line">root      7682 10.7  4.0 926472 154488 ?       SLl  21:14   0:07 /usr/bin/gnome-software --gapplication-service</span><br><span class="line">root      7719  0.5  0.6 373448 23936 ?        Ssl  21:14   0:00 /usr/lib/fwupd/fwupd</span><br><span class="line">root      7779  0.0  0.0      0     0 ?        I&lt;   21:14   0:00 [kworker/u17:4]</span><br><span class="line">root      7971  0.1  0.1  20728  5752 ?        Ss   21:15   0:00 /usr/bin/x11vnc -auth guess -forever -loop -noxdamage -repeat -rfbauth /root/.vnc/passwd -rfb</span><br><span class="line">root      7975  0.4  0.4  46324 16808 ?        S    21:15   0:00 /usr/bin/x11vnc -auth guess -forever -loop -noxdamage -repeat -rfbauth /root/.vnc/passwd -rfb</span><br><span class="line">root      8373  1.5  0.8 518120 33112 ?        Sl   21:15   0:00 /usr/lib/deja-dup/deja-dup-monitor</span><br><span class="line">root      8472  0.0  0.0   3468   456 ?        S    21:15   0:00 <span class="built_in">sleep</span> 1</span><br><span class="line">root      8473  0.0  0.0   6964  2764 pts/0    R+   21:15   0:00 ps aux</span><br><span class="line">root@paddlepi:~#</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>开机自启动脚本实现目录跳转<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250125183842774-1939584058.png" alt="img"></li>
</ol>
<hr>
<ol start="6">
<li>开机自启动脚本</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">echo 2097152 &gt; /proc/sys/net/core/rmem_max</span><br><span class="line">echo 2097152 &gt; /proc/sys/net/core/wmem_max</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nmcli g logging level debug</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">nmcli g logging domain all</span></span><br><span class="line"></span><br><span class="line">echo 1 &gt; /proc/sys/kernel/printk</span><br><span class="line"></span><br><span class="line">if [ -f /usr/sbin/ppboard.py ]; then</span><br><span class="line">    mac=$(ppboard.py -m | grep &#x27;^PPMAC&#x27; | awk &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">    if [ $mac != &quot;None&quot; ]; then</span><br><span class="line">        ip link set eth0 down</span><br><span class="line">        ip link set eth0 address $mac</span><br><span class="line">        ip link set eth0 up</span><br><span class="line">        nmcli device reapply eth0</span><br><span class="line">    fi</span><br><span class="line">    info=`ppboard.py`</span><br><span class="line">    logger -t &quot;rc.local&quot; &quot;$&#123;info&#125;&quot;</span><br><span class="line">fi</span><br><span class="line">source /root/bin/jiaoben1</span><br><span class="line">/usr/sbin/factorymode &amp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250125191842585-121658019.png" alt="img"></p>
<hr>
<hr>
<p>通讯<br>上位机部分<br>上位机需要发送的信息汇总    </p>
<ol>
<li>舵机+电机    </li>
<li>心脏信息    </li>
<li>标志位汇总（电机on,舵机on,编码on,陀螺off,DEBUGon,摇杆off）  （有空写）</li>
<li>Beep+Led   （有空写）<br>上位机做一个UART_SEND挂起发送，当需要发送（1，2，3，4）的时候，对应的uard_send挂起为1，发送总线程实时检测uart_send,如果为1（挂起），发送完置0</li>
</ol>
<hr>
<hr>
<p>2秒827帧，1秒413帧(计数100)(放在了串口发送子线程)</p>
<hr>
<p>2秒611帧 1秒315帧（计数60000）(放在了串口发送子线程)</p>
<p>16秒77帧 1秒5帧左右（计数10）（放在了图像处理线程）（说明图像处理线程1秒能处理48.125次，但是摄像头只有30帧哈） </p>
<hr>
<p>顺便测一下不开显示画面能处理多少帧<br>如果没有摄像头帧率的影响，和不开画面显示，500帧的处理速度（目前图像处理代码的处理速度）</p>
<hr>
<p>这样看，心跳帧不适合放在图像处理的线程中，最好还是独立  </p>
<hr>
<p>再单开了一个线程给心跳<br>95&#x2F;48约等于一秒2帧的心跳<br>代码有误，重新计算  </p>
<hr>
<p>出了一点小bug，咱先写下下位机部分的心跳功能  </p>
<hr>
<p>上位机的心跳频率还是要高一点才行  </p>
<hr>
<p>cmake -DCMAKE_BUILD_TYPE&#x3D;RELEASE -D WITH_FFMPEG&#x3D;ON ..<br>make -j4<br>sudo make install</p>
<hr>
<p>opencv出了点大问题  </p>
<hr>
<p>真够提神的<br>sudo apt-get install build-essential libgtk2.0-dev libavcodec-dev libavformat-dev libjpeg.dev libtiff4.dev libswscale-dev libjasper-dev</p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250126043047614-1760634097.png" alt="img"><br>我没有想到这两行代码威力这么大，居然注释掉就能让我打不开摄像头和视频  </p>
<hr>
<p>本来下午敲代码翘的好好的，然后突然就打不开摄像头和视频了。我把几乎所有代码都注释掉，就剩个图像显示都不行。就很懵逼<br>由于前面我刚往代码里面加了一些新的.h，然后下午还在倒腾一些系统配置。我就往链接编译和配置里面找bug。<br>然后搜出来的说法大半是opencv对ffmpeg库的依赖之类的。<br>试了好久配置无果，我就把板卡里面的opencv库删了又去学着重下。<br>下完还是这个现象差点崩溃。  </p>
<p>真的是偶然间把这两行代码注释去掉。心累了  </p>
<hr>
<p>20秒369帧   18.45fps(带显示)<br>30秒893帧   29.766fps(不带显示)<br>[04: 01: 54 477]收：42 21 02 03 04 05 06 07 08 09 0A 0B<br>[04: 01: 54 507]收：42 21 02 03 04 05 06 07 08 09 0A 0B<br>[04: 01: 54 536]收：42 21 02 03 04 05 06 07 08 09 0A 0B<br>[04: 01: 54 577]收：42 21 02 03 04 05 06 07 08 09 0A 0B<br>[04: 01: 54 607]收：42 21 02 03 04 05 06 07 08 09 0A 0B<br>[04: 01: 54 637]收：42 21 02 03 04 05 06 07 08 09 0A 0B </p>
<h2 id="1-26"><a href="#1-26" class="headerlink" title="1.26"></a>1.26</h2><p>这摄像头还真有问题<br>只有30帧，但是收两个摄像头的问题没解决  </p>
<hr>
<p>休息  </p>
<hr>
<ul>
<li>LADRC(线性自抗扰控制器)<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250127010617982-477973178.png" alt="img"></li>
</ul>
<ol>
<li>跟踪系数 r(定值，设置一次)   （r值越大，跟踪的越快，类比于比例系数？）   </li>
<li>补偿系数 b0(b0越大，输出系数的增益越小，作用力越弱（在数学公式中是放到分母的）)</li>
<li>(3.1)系统调节时间（ts:（依据系统判断））(这个确定了之后下面的两个也确定了) (网络系统从启动到达稳定的时间,需要自己进行一些测试判断)  </li>
<li>(3.2)控制器带宽wc&#x3D;10&#x2F;ts  </li>
<li>(3.3)观测器带宽w0&#x3D;4wc(一般取四倍的关系)<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250127011758797-422379380.png" alt="img"></li>
</ol>
<hr>
<p>LADRC中的TD跟踪微分器  以及参数r的调节方式  </p>
<ol>
<li>快速跟踪因子：r&gt;&#x3D;0  </li>
<li>结论：r越大，跟踪（逼近）期望值的速度越快，r增大到一定程度逼近速度便无明显变化  </li>
<li>结论2：r仅仅作用于系统初期，系统第一次到达稳态后，逼近结束，r的使命也到此结束</li>
</ol>
<p>td跟踪微分器可以动态地输出一个期望值（避免初期系统超调量过大）<br>这个动态的期望值最终还是会和我们给定的静态期望值达到一致（在这个过程中有一个逼近过程，涉及到一个时间问题，r越大，这个逼近就快；r仅仅是用来干这个的）<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250127013532888-1675944540.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250127021603287-962146613.png" alt="img"><br>r可以理解为一个滤波系数，r越小滤波效果就越好<br>TD目的是抑制初期超调，削去波峰    </p>
<p>扩张状态观测器  </p>
<ol>
<li>问题1：控制的手段是什么？（控制算法采用了什么方法使得我们的系统按期望运行）（我们用控制器到底干了什么事？）  </li>
<li>问题2：输出是什么？（为什么输出是这样的），输入是什么？（为什么输入是这样的？）  </li>
<li>问题3: （状态观测器到底解决了什么问题？）（不用观测器可以吗）（扩张观测器是什么）</li>
</ol>
<p>传统pid<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250127022533123-1509066407.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250127022703683-870587307.png" alt="img"><br>2个输入  （一个是控制器的输出，一个是系统的输出）<br>3个输出  （期望状态计算值，期望状态微分计算值，总扰动计算值）  </p>
<p>控制的方法和手段是什么：<br>控制的方法和手段就是<strong>观测</strong>，<strong>观察</strong>，不停的观察，比如用眼睛看，<br>反馈，把看到的告诉你<br>根据反馈回来的数据（ESO），做出相应的判断（控制率运算部分），把判断的结果给了执行器，执行器去调节期望的量。<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250127030804926-831369317.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250127032434864-20351281.png" alt="img"></p>
<h2 id="1-27"><a href="#1-27" class="headerlink" title="1.27"></a>1.27</h2><p>下位机两秒(2000ms)内无通信视为断开连接。  </p>
<hr>
<p>上位机每100ms发送一次心脏信号  </p>
<hr>
<p>21s  210帧 1s10帧的心跳帧</p>
<hr>
<p>[19: 01: 54 752]收：42 21 02 03 04 05 06 07 08 09 0A 0B<br>[19: 01: 54 852]收：42 21 02 03 04 05 06 07 08 09 0A 0B<br>[19: 01: 54 951]收：42 21 02 03 04 05 06 07 08 09 0A 0B<br>[19: 01: 55 052]收：42 21 02 03 04 05 06 07 08 09 0A 0B </p>
<hr>
<p>心脏信号接收没问题  </p>
<hr>
<p>由LCDH-1变到ImageStatus.ONLine<br>LCDH-2–&gt;ImageStatus.ONLine-1<br>LCDH-3–&gt;ImageStatus.ONLine-2<br>LCDH-4–&gt;ImageStatus.ONLine-3<br>LCDH-5–&gt;ImageStatus.ONLine-4<br>LCDH-6–&gt;ImageStatus.ONLine-5</p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250127212744932-903632041.png" alt="img"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">My_local_adaptive</span><span class="params">(Mat* srcImage, Mat* dstImage, <span class="type">int</span> areas_of_H, <span class="type">int</span> areas_of_W)</span>		<span class="comment">//局部自适应法   基于大津阈值areas_of_H：竖直方向分割的个数  areas_of_W：横坐标方向分割的个数</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> height = (*srcImage).rows/ areas_of_H;			<span class="comment">//每一小块的height</span></span><br><span class="line">	<span class="type">int</span> width = (*srcImage).cols/ areas_of_W;			<span class="comment">//每一小块的width</span></span><br><span class="line">	<span class="type">int</span> Ostu_Threshold = <span class="number">0</span>; <span class="comment">//大津阈值</span></span><br><span class="line">	<span class="type">int</span> size = height * width/ areas_of_H/ areas_of_W;		<span class="comment">//每一小块的size</span></span><br><span class="line">	<span class="comment">//一行一行地来</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">0</span>; y &lt; areas_of_H; y++)	</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">0</span>; x &lt; areas_of_W; x++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="type">float</span> variance = <span class="number">0</span>;   <span class="comment">//类间方差</span></span><br><span class="line">			<span class="type">float</span> maxVariance = <span class="number">0</span>, w1 = <span class="number">0</span>, w2 = <span class="number">0</span>, avgValue = <span class="number">0</span>;</span><br><span class="line">			<span class="type">float</span> u0 = <span class="number">0</span>, u1 = <span class="number">0</span>, u2 = <span class="number">0</span>;</span><br><span class="line">			<span class="comment">//生成areas_of_W*areas_of_H个局部灰度直方图</span></span><br><span class="line">			<span class="type">int</span> pixels[<span class="number">256</span>];</span><br><span class="line">			<span class="type">float</span> histgram[<span class="number">256</span>];</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++)</span><br><span class="line">			&#123;</span><br><span class="line">				pixels[i] = <span class="number">0</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//【处理每个小区域并且二值化】</span></span><br><span class="line">			<span class="comment">//【计算直方图】</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = y* height; j &lt; ((y + <span class="number">1</span> == areas_of_H) ? (*srcImage).rows : (y + <span class="number">1</span>) * height); j++) <span class="comment">//? : 是一个三目运算符，也是唯一的一个三目运算符。？前面表逻辑条件，：前面也就是？后面表示条件成立时的值，：后面表条件不成立时的值。例如，当a &gt; b时，x = 1否则x = 0，可以写成x = a &gt; b ? 1 : 0。</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> i = x * width; i &lt; ((x + <span class="number">1</span> == areas_of_W) ? (*srcImage).cols : (x + <span class="number">1</span>) * width); i++)</span><br><span class="line">				&#123;</span><br><span class="line">					pixels[(*srcImage).at&lt;uchar&gt;(j, i)]++;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//【直方图归一化】</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++)</span><br><span class="line">			&#123;</span><br><span class="line">				histgram[i] = pixels[i] * <span class="number">1.0f</span> / size;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//遍历找出类间方差最大（maxVariance）的阈值（Ostu_Threshold）</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt;= <span class="number">255</span>;i++)</span><br><span class="line">			&#123;</span><br><span class="line">				w1 = <span class="number">0</span>;</span><br><span class="line">				w2 = <span class="number">0</span>;</span><br><span class="line">				u1 = <span class="number">0</span>;</span><br><span class="line">				u2 = <span class="number">0</span>;</span><br><span class="line">				<span class="comment">//计算背景像素占比,平均灰度</span></span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>;j &lt;= i;j++)</span><br><span class="line">				&#123;</span><br><span class="line">					w1 += histgram[j];</span><br><span class="line">					u1 += histgram[j] * j;</span><br><span class="line">				&#125;</span><br><span class="line">				u1=u1/w1;</span><br><span class="line">				<span class="comment">//计算前景像素占比,平均灰度</span></span><br><span class="line">				w2 = <span class="number">1</span> - w1;</span><br><span class="line">				<span class="keyword">if</span> (i == <span class="number">255</span>)</span><br><span class="line">				&#123;</span><br><span class="line">					u2 = <span class="number">0</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span></span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">for</span> (<span class="type">int</span> j = i + <span class="number">1</span>;j &lt;= <span class="number">255</span>;j++)</span><br><span class="line">					&#123;</span><br><span class="line">						u2 += histgram[j] * j;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				u2=u2/w2;</span><br><span class="line">				<span class="comment">//计算类间方差</span></span><br><span class="line">				variance = w1 * w2 * (u1 - u2) * (u1 - u2);</span><br><span class="line">				<span class="keyword">if</span> (variance &gt; maxVariance)</span><br><span class="line">				&#123; <span class="comment">//找到使灰度差最大的值</span></span><br><span class="line">					maxVariance = variance;</span><br><span class="line">					Ostu_Threshold = i;            <span class="comment">//那个值就是阈值</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;大津法阈值为：&quot;</span> &lt;&lt; Ostu_Threshold &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">			<span class="comment">//【3】二值化</span></span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> j = y * height; j &lt; ((y + <span class="number">1</span> == areas_of_H) ? (*srcImage).rows : (y + <span class="number">1</span>) * height); j++) <span class="comment">//? : 是一个三目运算符，也是唯一的一个三目运算符。？前面表逻辑条件，：前面也就是？后面表示条件成立时的值，：后面表条件不成立时的值。例如，当a &gt; b时，x = 1否则x = 0，可以写成x = a &gt; b ? 1 : 0。</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">for</span> (<span class="type">int</span> i = x * width; i &lt; ((x + <span class="number">1</span> == areas_of_W) ? (*srcImage).cols : (x + <span class="number">1</span>) * width); i++)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="keyword">if</span> ((*srcImage).at&lt;uchar&gt;(j, i) &gt;= Ostu_Threshold)</span><br><span class="line">					&#123;</span><br><span class="line">						(*dstImage).at&lt;uchar&gt;(j, i) = <span class="number">255</span>;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">else</span></span><br><span class="line">					&#123;</span><br><span class="line">						(*dstImage).at&lt;uchar&gt;(j, i) = <span class="number">0</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">		<span class="comment">//Mat srcImage = imread(&quot;D:\opencv_picture_test\新垣结衣\test2.jpg&quot;, 0);	//读入的时候转化为灰度图</span></span><br><span class="line">		<span class="comment">//Mat srcImage = imread(&quot;D:\opencv_picture_test\miku\miku2.jpg&quot;, 0);	//读入的时候转化为灰度图</span></span><br><span class="line">		Mat srcImage = imread(<span class="string">&quot;D:\opencv_picture_test\阈值处理\带噪声阴影的图.png&quot;</span>, <span class="number">0</span>);	<span class="comment">//读入的时候转化为灰度图</span></span><br><span class="line">		namedWindow(<span class="string">&quot;原始图&quot;</span>, WINDOW_NORMAL);<span class="comment">//WINDOW_NORMAL允许用户自由伸缩窗口</span></span><br><span class="line">		imshow(<span class="string">&quot;原始图&quot;</span>, srcImage);</span><br><span class="line">	</span><br><span class="line">		Mat dstImage;</span><br><span class="line">		dstImage.create(srcImage.rows, srcImage.cols, CV_8UC1);</span><br><span class="line">		<span class="type">double</span> time0 = static_cast&lt;<span class="type">double</span>&gt;(getTickCount());	<span class="comment">//记录起始时间</span></span><br><span class="line">		<span class="comment">//阈值处理+二值化</span></span><br><span class="line">		<span class="comment">//My_P_tile(&amp;srcImage,&amp;dstImage,20);			//设P为20</span></span><br><span class="line">		<span class="comment">//My_Iteration(&amp;srcImage, &amp;dstImage,0.01);</span></span><br><span class="line">		<span class="comment">//My_Ostu(&amp;srcImage, &amp;dstImage);</span></span><br><span class="line">		My_local_adaptive(&amp;srcImage, &amp;dstImage, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">		<span class="comment">//一系列处理之后</span></span><br><span class="line">		time0 = ((<span class="type">double</span>)getTickCount() - time0) / getTickFrequency();</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;此方法运行时间为：&quot;</span> &lt;&lt; time0 &lt;&lt; <span class="string">&quot;秒&quot;</span> &lt;&lt; <span class="built_in">endl</span>;	<span class="comment">//输出运行时间</span></span><br><span class="line">		namedWindow(<span class="string">&quot;效果图&quot;</span>, WINDOW_NORMAL);<span class="comment">//WINDOW_NORMAL允许用户自由伸缩窗口</span></span><br><span class="line">		imshow(<span class="string">&quot;效果图&quot;</span>, dstImage);</span><br><span class="line">		dstImage = My_Rraw_histogram(&amp;srcImage);</span><br><span class="line">		namedWindow(<span class="string">&quot;一维直方图&quot;</span>, WINDOW_NORMAL);<span class="comment">//WINDOW_NORMAL允许用户自由伸缩窗口</span></span><br><span class="line">		imshow(<span class="string">&quot;一维直方图&quot;</span>, dstImage);</span><br><span class="line">		waitKey(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="1-28"><a href="#1-28" class="headerlink" title="1.28"></a>1.28</h2><p>0       1       2       3…………………………………………………………LCDW-3  LCDW-2  LCDW-1<br>LCDW  LCDW+1  LCDW+2  LCDW+3………………………………………………2LCDW-3 2LCDW-2 2LCDW-1  </p>
<hr>
<p><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128083504560-1914920773.png" alt="img"></p>
<hr>
<p>0   1   2   3   ………………………………………………………………LCDW-3  LCDW-2  LCDW-1<br>1<br>2<br>3<br>^<br>^<br>^<br>LCDH-3<br>LCDH-2<br>LCDH-1</p>
<hr>
<p>第一个想法：对每行独立进行大津法：变化太多，很容易出现全色行扰乱全图结果<br>第二个想法：只取中间部分进行大津法，去掉四周看的太广的赛道外的因素：其实情况同上，还是会出现中间一块全色导致阈值不理想的情况<br>第三个想法：分四个象限各自大津法，<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128181718126-47698937.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128182039790-1703893036.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128182201119-158605050.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128182308227-1146693076.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128182423392-565787787.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128182543460-818439064.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128182644219-1873339130.png" alt="img"><br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128183606776-2107757927.png" alt="img"><br>感觉还是只能看原版  </p>
<hr>
<p>废啊</p>
<hr>
<p>白列高度：white<br>用于计算动态前瞻的过渡值whitehigh_float:whitehigh_float &#x3D; (float)(whitehigh - 40)&#x2F;(55 - 5)  –直线（-1.25~1.25，）<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128185519311-1979130623.png" alt="img"><br>长白列前瞻因子WhiteGain&#x3D;9whitehigh_float:(-11.25  —   11.25)(当白列高度是图像高度的一半的时候是0)<br><img src="https://img2023.cnblogs.com/blog/3084836/202501/3084836-20250128185607412-1815770606.png" alt="img"></p>
<hr>
<hr>
<h2 id="1-29"><a href="#1-29" class="headerlink" title="1.29"></a>1.29</h2><p>过  </p>
<hr>
<h2 id="1-30"><a href="#1-30" class="headerlink" title="1.30"></a>1.30</h2><!-- flag of hidden posts -->
      
    </div>
    
  </div>
  
    
  
</article>






</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2025 shenle
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/preccrep/hexo-theme-jelly" target="_blank">Jelly</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: true
	}
</script>

<script src="/js/main.js"></script>




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js"></script>


  </div>
</body>
</html>